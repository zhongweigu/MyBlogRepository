---
title: C++é«˜çº§ç¨‹åºè®¾è®¡
date: 2025-08-28 19:50:01
categories:   "è¯¾ç¨‹å¤ä¹ "
tags: [C++]
toc : true
---

# åŸºæœ¬è¯­æ³•ä¸æ•°æ®ç»“æ„

## 1. ç¼–è¯‘/æ‰§è¡Œ

```c++
#include <iostream>
using namespace std;
int main()
{
    cout << "Hello, world!" << endl;
    return 0;
}
```

## 2. æ•°å­—

æ•°å­¦è¿ç®—

```C++
#include <iostream>
#include <cmath>
using namespace std;
 
int main ()
{
   // æ•°å­—å®šä¹‰
   short  s = 10;
   int    i = -1000;
   long   l = 100000;
   float  f = 230.47;
   double d = 200.374;
 
   // æ•°å­¦è¿ç®—
   cout << "sin(d) :" << sin(d) << endl;
   cout << "abs(i)  :" << abs(i) << endl;
   cout << "floor(d) :" << floor(d) << endl;
   cout << "sqrt(f) :" << sqrt(f) << endl;
   cout << "pow( d, 2) :" << pow(d, 2) << endl;
 
   return 0;
}
```

éšæœºæ•°

```c++
#include <iostream>
#include <ctime>
#include <cstdlib>
 
using namespace std;
 
int main ()
{
   int i,j;
 
   // è®¾ç½®ç§å­
   srand( (unsigned)time( NULL ) );
 
   /* ç”Ÿæˆ 10 ä¸ªéšæœºæ•° */
   for( i = 0; i < 10; i++ )
   {
      // ç”Ÿæˆå®é™…çš„éšæœºæ•°
      j= rand();
      cout <<"éšæœºæ•°ï¼š " << j << endl;
   }
 
   return 0;
}
```

å¸¸æ•°

```c++
#include <cmath>
#include <iostream>

int main() {
    std::cout << "pi: " << std::numbers::pi << std::endl;
    std::cout << "e: " << std::numbers::e << std::endl;
    std::cout << "phi: " << std::numbers::phi << std::endl;	// é»„é‡‘æ¯”ä¾‹
}
```

## 3. å­—ç¬¦ä¸²

ä¸‹é¢çš„å£°æ˜å’Œåˆå§‹åŒ–åˆ›å»ºäº†ä¸€ä¸ª **RUNOOB** å­—ç¬¦ä¸²ã€‚ç”±äºåœ¨æ•°ç»„çš„æœ«å°¾å­˜å‚¨äº†ç©ºå­—ç¬¦ï¼Œæ‰€ä»¥å­—ç¬¦æ•°ç»„çš„å¤§å°æ¯”å•è¯ **RUNOOB** çš„å­—ç¬¦æ•°å¤šä¸€ä¸ªã€‚

```c++
char site[7] = {'R', 'U', 'N', 'O', 'O', 'B', '\0'};
```

ä¾æ®æ•°ç»„åˆå§‹åŒ–è§„åˆ™ï¼Œä¸Šé¢çš„è¯­å¥å†™æˆä»¥ä¸‹è¯­å¥ï¼š

```c++
char site[] = "RUNOOB";
```

C++ ä¸­æœ‰å¤§é‡çš„å‡½æ•°ç”¨æ¥æ“ä½œä»¥ null ç»“å°¾çš„å­—ç¬¦ä¸²:

| åºå· | å‡½æ•° & ç›®çš„                                                  |
| :--- | :----------------------------------------------------------- |
| 1    | **strcpy(s1, s2);** å¤åˆ¶å­—ç¬¦ä¸² s2 åˆ°å­—ç¬¦ä¸² s1ã€‚              |
| 2    | **strcat(s1, s2);** è¿æ¥å­—ç¬¦ä¸² s2 åˆ°å­—ç¬¦ä¸² s1 çš„æœ«å°¾ã€‚è¿æ¥å­—ç¬¦ä¸²ä¹Ÿå¯ä»¥ç”¨ **+** å·ï¼Œä¾‹å¦‚: `string str1 = "runoob"; string str2 = "google"; string str = str1 + str2;` |
| 3    | **strlen(s1);** è¿”å›å­—ç¬¦ä¸² s1 çš„é•¿åº¦ã€‚                       |
| 4    | **strcmp(s1, s2);** å¦‚æœ s1 å’Œ s2 æ˜¯ç›¸åŒçš„ï¼Œåˆ™è¿”å› 0ï¼›å¦‚æœ s1<s2 åˆ™è¿”å›å€¼å°äº 0ï¼›å¦‚æœ s1>s2 åˆ™è¿”å›å€¼å¤§äº 0ã€‚ |
| 5    | **strchr(s1, ch);** è¿”å›ä¸€ä¸ªæŒ‡é’ˆï¼ŒæŒ‡å‘å­—ç¬¦ä¸² s1 ä¸­å­—ç¬¦ ch çš„ç¬¬ä¸€æ¬¡å‡ºç°çš„ä½ç½®ã€‚ |
| 6    | **strstr(s1, s2);** è¿”å›ä¸€ä¸ªæŒ‡é’ˆï¼ŒæŒ‡å‘å­—ç¬¦ä¸² s1 ä¸­å­—ç¬¦ä¸² s2 çš„ç¬¬ä¸€æ¬¡å‡ºç°çš„ä½ç½®ã€‚ |

ä¸‹é¢çš„å®ä¾‹ä½¿ç”¨äº†ä¸Šè¿°çš„ä¸€äº›å‡½æ•°ï¼š

```C++
#include <iostream>
#include <cstring>
 
using namespace std;
 
int main ()
{
   char str1[13] = "runoob";
   char str2[13] = "google";
   char str3[13];
   int  len ;
 
   // å¤åˆ¶ str1 åˆ° str3
   strcpy( str3, str1);
   cout << "strcpy( str3, str1) : " << str3 << endl;
 
   // è¿æ¥ str1 å’Œ str2
   strcat( str1, str2);
   cout << "strcat( str1, str2): " << str1 << endl;
 
   // è¿æ¥åï¼Œstr1 çš„æ€»é•¿åº¦
   len = strlen(str1);
   cout << "strlen(str1) : " << len << endl;
 
   return 0;
}
```

å½“ä¸Šé¢çš„ä»£ç è¢«ç¼–è¯‘å’Œæ‰§è¡Œæ—¶ï¼Œå®ƒä¼šäº§ç”Ÿä¸‹åˆ—ç»“æœï¼š

```C++
strcpy( str3, str1) : runoob
strcat( str1, str2): runoobgoogle
strlen(str1) : 12
```

## 4. æŒ‡é’ˆ

```C++
#include <iostream>
 
using namespace std;
 
int main ()
{
   int  var = 20;   // å®é™…å˜é‡çš„å£°æ˜
   int  *ip;        // æŒ‡é’ˆå˜é‡çš„å£°æ˜
 
   ip = &var;       // åœ¨æŒ‡é’ˆå˜é‡ä¸­å­˜å‚¨ var çš„åœ°å€
 
   cout << "Value of var variable: ";
   cout << var << endl;
 
   // è¾“å‡ºåœ¨æŒ‡é’ˆå˜é‡ä¸­å­˜å‚¨çš„åœ°å€
   cout << "Address stored in ip variable: ";
   cout << ip << endl;
 
   // è®¿é—®æŒ‡é’ˆä¸­åœ°å€çš„å€¼
   cout << "Value of *ip variable: ";
   cout << *ip << endl;
 
   return 0;
}
```

## 5. C++ æ—¥æœŸ & æ—¶é—´

ä¸‹é¢æ˜¯ C/C++ ä¸­å…³äºæ—¥æœŸå’Œæ—¶é—´çš„é‡è¦å‡½æ•°ã€‚æ‰€æœ‰è¿™äº›å‡½æ•°éƒ½æ˜¯ C/C++ æ ‡å‡†åº“çš„ç»„æˆéƒ¨åˆ†ï¼Œæ‚¨å¯ä»¥åœ¨ C++ æ ‡å‡†åº“ä¸­æŸ¥çœ‹ä¸€ä¸‹å„ä¸ªå‡½æ•°çš„ç»†èŠ‚ã€‚

| åºå· | å‡½æ•° & æè¿°                                                  |
| :--- | :----------------------------------------------------------- |
| 1    | [**time_t time(time_t \*time);**](https://www.runoob.com/cplusplus/c-function-time.html) è¯¥å‡½æ•°è¿”å›ç³»ç»Ÿçš„å½“å‰æ—¥å†æ—¶é—´ï¼Œè‡ª 1970 å¹´ 1 æœˆ 1 æ—¥ä»¥æ¥ç»è¿‡çš„ç§’æ•°ã€‚å¦‚æœç³»ç»Ÿæ²¡æœ‰æ—¶é—´ï¼Œåˆ™è¿”å› -1ã€‚ |
| 2    | [**char \*ctime(const time_t \*time);**](https://www.runoob.com/cplusplus/c-function-ctime.html) è¿”å›ä¸€ä¸ªæŒ‡å‘å­—ç¬¦ä¸²çš„æŒ‡é’ˆï¼Œå­—ç¬¦ä¸²å†…å®¹è¡¨ç¤ºæœ¬åœ°æ—¶é—´ï¼Œæ ¼å¼ä¸ºï¼š`Www Mmm dd hh:mm:ss yyyy\n\0`å…¶ä¸­ï¼š`Www`ï¼šæ˜ŸæœŸï¼ˆå¦‚ Tueï¼‰`Mmm`ï¼šæœˆä»½ï¼ˆå¦‚ Julï¼‰`dd`ï¼šæ—¥ï¼ˆå¦‚ 29ï¼‰`hh:mm:ss`ï¼šæ—¶é—´ï¼ˆ24 å°æ—¶åˆ¶ï¼‰`yyyy`ï¼šå¹´ä»½ï¼ˆå¦‚ 2025ï¼‰æœ€ååŒ…å«æ¢è¡Œç¬¦ `\n` å’Œç»“æŸç¬¦ `\0`ç¤ºä¾‹è¿”å›å€¼ï¼š`"Tue Jul 29 19:12:15 2025\n\0"` |
| 3    | [**struct tm \*localtime(const time_t \*time);**](https://www.runoob.com/cplusplus/c-function-localtime.html) è¯¥å‡½æ•°è¿”å›ä¸€ä¸ªæŒ‡å‘è¡¨ç¤ºæœ¬åœ°æ—¶é—´çš„ **tm** ç»“æ„çš„æŒ‡é’ˆã€‚ |
| 4    | [**clock_t clock(void);**](https://www.runoob.com/cplusplus/c-function-clock.html) è¯¥å‡½æ•°è¿”å›ç¨‹åºæ‰§è¡Œèµ·ï¼ˆä¸€èˆ¬ä¸ºç¨‹åºçš„å¼€å¤´ï¼‰ï¼Œå¤„ç†å™¨æ—¶é’Ÿæ‰€ä½¿ç”¨çš„æ—¶é—´ã€‚å¦‚æœæ—¶é—´ä¸å¯ç”¨ï¼Œåˆ™è¿”å› -1ã€‚ |
| 5    | [**char \* asctime ( const struct tm \* time );**](https://www.runoob.com/cplusplus/c-function-asctime.html) è¯¥å‡½æ•°è¿”å›ä¸€ä¸ªæŒ‡å‘å­—ç¬¦ä¸²çš„æŒ‡é’ˆï¼Œå­—ç¬¦ä¸²åŒ…å«äº† time æ‰€æŒ‡å‘ç»“æ„ä¸­å­˜å‚¨çš„ä¿¡æ¯ï¼Œè¿”å›å½¢å¼ä¸ºï¼šday month date hours:minutes:seconds year\n\0ã€‚ |
| 6    | [**struct tm \*gmtime(const time_t \*time);**](https://www.runoob.com/cplusplus/c-function-gmtime.html) è¯¥å‡½æ•°è¿”å›ä¸€ä¸ªæŒ‡å‘ time çš„æŒ‡é’ˆï¼Œtime ä¸º tm ç»“æ„ï¼Œç”¨åè°ƒä¸–ç•Œæ—¶ï¼ˆUTCï¼‰ä¹Ÿè¢«ç§°ä¸ºæ ¼æ—å°¼æ²»æ ‡å‡†æ—¶é—´ï¼ˆGMTï¼‰è¡¨ç¤ºã€‚ |
| 7    | [**time_t mktime(struct tm \*time);**](https://www.runoob.com/cplusplus/c-function-mktime.html) è¯¥å‡½æ•°è¿”å›æ—¥å†æ—¶é—´ï¼Œç›¸å½“äº time æ‰€æŒ‡å‘ç»“æ„ä¸­å­˜å‚¨çš„æ—¶é—´ã€‚ |
| 8    | [**double difftime ( time_t time2, time_t time1 );**](https://www.runoob.com/cplusplus/c-function-difftime.html) è¯¥å‡½æ•°è¿”å› time1 å’Œ time2 ä¹‹é—´ç›¸å·®çš„ç§’æ•°ã€‚ |
| 9    | [**size_t strftime();**](https://www.runoob.com/cplusplus/c-function-strftime.html) è¯¥å‡½æ•°å¯ç”¨äºæ ¼å¼åŒ–æ—¥æœŸå’Œæ—¶é—´ä¸ºæŒ‡å®šçš„æ ¼å¼ã€‚ |

ä¸‹é¢çš„å®ä¾‹è·å–å½“å‰ç³»ç»Ÿçš„æ—¥æœŸå’Œæ—¶é—´ï¼ŒåŒ…æ‹¬æœ¬åœ°æ—¶é—´å’Œåè°ƒä¸–ç•Œæ—¶ï¼ˆUTCï¼‰ã€‚

```C++
#include <iostream>
#include <ctime>
 
using namespace std;
 
int main( )
{
   // åŸºäºå½“å‰ç³»ç»Ÿçš„å½“å‰æ—¥æœŸ/æ—¶é—´
   time_t now = time(0);
   
   // æŠŠ now è½¬æ¢ä¸ºå­—ç¬¦ä¸²å½¢å¼
   char* dt = ctime(&now);
 
   cout << "æœ¬åœ°æ—¥æœŸå’Œæ—¶é—´ï¼š" << dt << endl;
 
   // æŠŠ now è½¬æ¢ä¸º tm ç»“æ„
   tm *gmtm = gmtime(&now);
   dt = asctime(gmtm);
   cout << "UTC æ—¥æœŸå’Œæ—¶é—´ï¼š"<< dt << endl;
}
```

å½“ä¸Šé¢çš„ä»£ç è¢«ç¼–è¯‘å’Œæ‰§è¡Œæ—¶ï¼Œå®ƒä¼šäº§ç”Ÿä¸‹åˆ—ç»“æœï¼š

```
æœ¬åœ°æ—¥æœŸå’Œæ—¶é—´ï¼šSat Jan  8 20:07:41 2011

UTC æ—¥æœŸå’Œæ—¶é—´ï¼šSun Jan  9 03:07:41 2011
```

**tm** ç»“æ„åœ¨ C/C++ ä¸­å¤„ç†æ—¥æœŸå’Œæ—¶é—´ç›¸å…³çš„æ“ä½œæ—¶ï¼Œæ˜¾å¾—å°¤ä¸ºé‡è¦ã€‚tm ç»“æ„ä»¥ C ç»“æ„çš„å½¢å¼ä¿å­˜æ—¥æœŸå’Œæ—¶é—´ã€‚å¤§å¤šæ•°ä¸æ—¶é—´ç›¸å…³çš„å‡½æ•°éƒ½ä½¿ç”¨äº† tm ç»“æ„ã€‚ä¸‹é¢çš„å®ä¾‹ä½¿ç”¨äº† tm ç»“æ„å’Œå„ç§ä¸æ—¥æœŸå’Œæ—¶é—´ç›¸å…³çš„å‡½æ•°ã€‚

åœ¨ç»ƒä¹ ä½¿ç”¨ç»“æ„ä¹‹å‰ï¼Œéœ€è¦å¯¹ C ç»“æ„æœ‰åŸºæœ¬çš„äº†è§£ï¼Œå¹¶æ‡‚å¾—å¦‚ä½•ä½¿ç”¨ç®­å¤´ -> è¿ç®—ç¬¦æ¥è®¿é—®ç»“æ„æˆå‘˜ã€‚

```c++
#include <iostream>
#include <ctime>
 
using namespace std;
 
int main( )
{
   // åŸºäºå½“å‰ç³»ç»Ÿçš„å½“å‰æ—¥æœŸ/æ—¶é—´
   time_t now = time(0);
 
   cout << "1970 åˆ°ç›®å‰ç»è¿‡ç§’æ•°:" << now << endl;
 
   tm *ltm = localtime(&now);
 
   // è¾“å‡º tm ç»“æ„çš„å„ä¸ªç»„æˆéƒ¨åˆ†
   cout << "å¹´: "<< 1900 + ltm->tm_year << endl;
   cout << "æœˆ: "<< 1 + ltm->tm_mon<< endl;
   cout << "æ—¥: "<<  ltm->tm_mday << endl;
   cout << "æ—¶é—´: "<< ltm->tm_hour << ":";
   cout << ltm->tm_min << ":";
   cout << ltm->tm_sec << endl;
}
```

å½“ä¸Šé¢çš„ä»£ç è¢«ç¼–è¯‘å’Œæ‰§è¡Œæ—¶ï¼Œå®ƒä¼šäº§ç”Ÿä¸‹åˆ—ç»“æœï¼š

```
1970 åˆ°ç›®å‰æ—¶é—´:1503564157
å¹´: 2017
æœˆ: 8
æ—¥: 24
æ—¶é—´: 16:42:37
```

## 6. è¾“å…¥è¾“å‡º

**æ ‡å‡†è¾“å‡ºæµï¼ˆcoutï¼‰**

é¢„å®šä¹‰çš„å¯¹è±¡ **cout** æ˜¯ **iostream** ç±»çš„ä¸€ä¸ªå®ä¾‹ã€‚cout å¯¹è±¡"è¿æ¥"åˆ°æ ‡å‡†è¾“å‡ºè®¾å¤‡ï¼Œé€šå¸¸æ˜¯æ˜¾ç¤ºå±ã€‚**cout** æ˜¯ä¸æµæ’å…¥è¿ç®—ç¬¦ << ç»“åˆä½¿ç”¨çš„ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š

```c++
#include <iostream>
 
using namespace std;
 
int main( )
{
   char str[] = "Hello C++";
 
   cout << "Value of str is : " << str << endl;
}
```

å½“ä¸Šé¢çš„ä»£ç è¢«ç¼–è¯‘å’Œæ‰§è¡Œæ—¶ï¼Œå®ƒä¼šäº§ç”Ÿä¸‹åˆ—ç»“æœï¼š

```
Value of str is : Hello C++
```

C++ ç¼–è¯‘å™¨æ ¹æ®è¦è¾“å‡ºå˜é‡çš„æ•°æ®ç±»å‹ï¼Œé€‰æ‹©åˆé€‚çš„æµæ’å…¥è¿ç®—ç¬¦æ¥æ˜¾ç¤ºå€¼ã€‚<< è¿ç®—ç¬¦è¢«é‡è½½æ¥è¾“å‡ºå†…ç½®ç±»å‹ï¼ˆæ•´å‹ã€æµ®ç‚¹å‹ã€double å‹ã€å­—ç¬¦ä¸²å’ŒæŒ‡é’ˆï¼‰çš„æ•°æ®é¡¹ã€‚

æµæ’å…¥è¿ç®—ç¬¦ << åœ¨ä¸€ä¸ªè¯­å¥ä¸­å¯ä»¥å¤šæ¬¡ä½¿ç”¨ï¼Œå¦‚ä¸Šé¢å®ä¾‹ä¸­æ‰€ç¤ºï¼Œ**endl** ç”¨äºåœ¨è¡Œæœ«æ·»åŠ ä¸€ä¸ªæ¢è¡Œç¬¦ã€‚

**æ ‡å‡†è¾“å…¥æµï¼ˆcinï¼‰**

é¢„å®šä¹‰çš„å¯¹è±¡ **cin** æ˜¯ **iostream** ç±»çš„ä¸€ä¸ªå®ä¾‹ã€‚cin å¯¹è±¡é™„å±åˆ°æ ‡å‡†è¾“å…¥è®¾å¤‡ï¼Œé€šå¸¸æ˜¯é”®ç›˜ã€‚**cin** æ˜¯ä¸æµæå–è¿ç®—ç¬¦ >> ç»“åˆä½¿ç”¨çš„ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š

```c++
#include <iostream>
 
using namespace std;
 
int main( )
{
   char name[50];
 
   cout << "è¯·è¾“å…¥æ‚¨çš„åç§°ï¼š ";
   cin >> name;
   cout << "æ‚¨çš„åç§°æ˜¯ï¼š " << name << endl;
 
}
```

å½“ä¸Šé¢çš„ä»£ç è¢«ç¼–è¯‘å’Œæ‰§è¡Œæ—¶ï¼Œå®ƒä¼šæç¤ºç”¨æˆ·è¾“å…¥åç§°ã€‚å½“ç”¨æˆ·è¾“å…¥ä¸€ä¸ªå€¼ï¼Œå¹¶æŒ‰å›è½¦é”®ï¼Œå°±ä¼šçœ‹åˆ°ä¸‹åˆ—ç»“æœï¼š

```
è¯·è¾“å…¥æ‚¨çš„åç§°ï¼š cplusplus
æ‚¨çš„åç§°æ˜¯ï¼š cplusplus
```

C++ ç¼–è¯‘å™¨æ ¹æ®è¦è¾“å…¥å€¼çš„æ•°æ®ç±»å‹ï¼Œé€‰æ‹©åˆé€‚çš„æµæå–è¿ç®—ç¬¦æ¥æå–å€¼ï¼Œå¹¶æŠŠå®ƒå­˜å‚¨åœ¨ç»™å®šçš„å˜é‡ä¸­ã€‚

æµæå–è¿ç®—ç¬¦ >> åœ¨ä¸€ä¸ªè¯­å¥ä¸­å¯ä»¥å¤šæ¬¡ä½¿ç”¨ï¼Œå¦‚æœè¦æ±‚è¾“å…¥å¤šä¸ªæ•°æ®ï¼Œå¯ä»¥ä½¿ç”¨å¦‚ä¸‹è¯­å¥ï¼š

```
cin >> name >> age;
```

è¿™ç›¸å½“äºä¸‹é¢ä¸¤ä¸ªè¯­å¥ï¼š

```
cin >> name;
cin >> age;
```

## 7. vector

C++ ä¸­çš„ vector æ˜¯ä¸€ç§åºåˆ—å®¹å™¨ï¼Œå®ƒå…è®¸ä½ åœ¨è¿è¡Œæ—¶åŠ¨æ€åœ°æ’å…¥å’Œåˆ é™¤å…ƒç´ ã€‚

vector æ˜¯åŸºäºæ•°ç»„çš„æ•°æ®ç»“æ„ï¼Œä½†å®ƒå¯ä»¥è‡ªåŠ¨ç®¡ç†å†…å­˜ï¼Œè¿™æ„å‘³ç€ä½ ä¸éœ€è¦æ‰‹åŠ¨åˆ†é…å’Œé‡Šæ”¾å†…å­˜ã€‚

ä¸ C++ æ•°ç»„ç›¸æ¯”ï¼Œvector å…·æœ‰æ›´å¤šçš„çµæ´»æ€§å’ŒåŠŸèƒ½ï¼Œä½¿å…¶æˆä¸º C++ ä¸­å¸¸ç”¨çš„æ•°æ®ç»“æ„ä¹‹ä¸€ã€‚

vector æ˜¯ C++ æ ‡å‡†æ¨¡æ¿åº“ï¼ˆSTLï¼‰çš„ä¸€éƒ¨åˆ†ï¼Œæä¾›äº†çµæ´»çš„æ¥å£å’Œé«˜æ•ˆçš„æ“ä½œã€‚

**åŸºæœ¬ç‰¹æ€§:**

- **åŠ¨æ€å¤§å°**ï¼š`vector` çš„å¤§å°å¯ä»¥æ ¹æ®éœ€è¦è‡ªåŠ¨å¢é•¿å’Œç¼©å°ã€‚
- **è¿ç»­å­˜å‚¨**ï¼š`vector` ä¸­çš„å…ƒç´ åœ¨å†…å­˜ä¸­æ˜¯è¿ç»­å­˜å‚¨çš„ï¼Œè¿™ä½¿å¾—è®¿é—®å…ƒç´ éå¸¸å¿«é€Ÿã€‚
- **å¯è¿­ä»£**ï¼š`vector` å¯ä»¥è¢«è¿­ä»£ï¼Œä½ å¯ä»¥ä½¿ç”¨å¾ªç¯ï¼ˆå¦‚ `for` å¾ªç¯ï¼‰æ¥è®¿é—®å®ƒçš„å…ƒç´ ã€‚
- **å…ƒç´ ç±»å‹**ï¼š`vector` å¯ä»¥å­˜å‚¨ä»»ä½•ç±»å‹çš„å…ƒç´ ï¼ŒåŒ…æ‹¬å†…ç½®ç±»å‹ã€å¯¹è±¡ã€æŒ‡é’ˆç­‰ã€‚

**ä½¿ç”¨åœºæ™¯ï¼š**

- å½“ä½ éœ€è¦ä¸€ä¸ªå¯ä»¥åŠ¨æ€å¢é•¿å’Œç¼©å°çš„æ•°ç»„æ—¶ã€‚
- å½“ä½ éœ€è¦é¢‘ç¹åœ°åœ¨åºåˆ—çš„æœ«å°¾æ·»åŠ æˆ–ç§»é™¤å…ƒç´ æ—¶ã€‚
- å½“ä½ éœ€è¦ä¸€ä¸ªå¯ä»¥é«˜æ•ˆéšæœºè®¿é—®å…ƒç´ çš„å®¹å™¨æ—¶ã€‚

è¦ä½¿ç”¨ vectorï¼Œé¦–å…ˆéœ€è¦åŒ…å« **<vector>** å¤´æ–‡ä»¶ï¼š

```
#include <vector>
```

åˆ›å»ºä¸€ä¸ª vector å¯ä»¥åƒåˆ›å»ºå…¶ä»–å˜é‡ä¸€æ ·ç®€å•ï¼š

```
std::vector<int> myVector; // åˆ›å»ºä¸€ä¸ªå­˜å‚¨æ•´æ•°çš„ç©º vector
```

è¿™å°†åˆ›å»ºä¸€ä¸ªç©ºçš„æ•´æ•°å‘é‡,ä¹Ÿå¯ä»¥åœ¨åˆ›å»ºæ—¶æŒ‡å®šåˆå§‹å¤§å°å’Œåˆå§‹å€¼ï¼š

```
std::vector<int> myVector(5); // åˆ›å»ºä¸€ä¸ªåŒ…å« 5 ä¸ªæ•´æ•°çš„ vectorï¼Œæ¯ä¸ªå€¼éƒ½ä¸ºé»˜è®¤å€¼ï¼ˆ0ï¼‰
std::vector<int> myVector(5, 10); // åˆ›å»ºä¸€ä¸ªåŒ…å« 5 ä¸ªæ•´æ•°çš„ vectorï¼Œæ¯ä¸ªå€¼éƒ½ä¸º 10
```

æˆ–ï¼š

```
std::vector<int> vec; // é»˜è®¤åˆå§‹åŒ–ä¸€ä¸ªç©ºçš„ vector
std::vector<int> vec2 = {1, 2, 3, 4}; // åˆå§‹åŒ–ä¸€ä¸ªåŒ…å«å…ƒç´ çš„ vector
```

å¯ä»¥ä½¿ç”¨ push_back æ–¹æ³•å‘ vector ä¸­æ·»åŠ å…ƒç´ ï¼š

```
myVector.push_back(7); // å°†æ•´æ•° 7 æ·»åŠ åˆ° vector çš„æœ«å°¾
```

å¯ä»¥ä½¿ç”¨ä¸‹æ ‡æ“ä½œç¬¦ [] æˆ– at() æ–¹æ³•è®¿é—® vector ä¸­çš„å…ƒç´ ï¼š

```
int x = myVector[0]; // è·å–ç¬¬ä¸€ä¸ªå…ƒç´ 
int y = myVector.at(1); // è·å–ç¬¬äºŒä¸ªå…ƒç´ 
```

å¯ä»¥ä½¿ç”¨ size() æ–¹æ³•è·å– vector ä¸­å…ƒç´ çš„æ•°é‡ï¼š

```
int size = myVector.size(); // è·å– vector ä¸­çš„å…ƒç´ æ•°é‡
```

å¯ä»¥ä½¿ç”¨è¿­ä»£å™¨éå† vector ä¸­çš„å…ƒç´ ï¼š

```
for (auto it = myVector.begin(); it != myVector.end(); ++it) {
    std::cout << *it << " ";
}
```

æˆ–è€…ä½¿ç”¨èŒƒå›´å¾ªç¯ï¼š

```
for (int element : myVector) {
    std::cout << element << " ";
}
```

å¯ä»¥ä½¿ç”¨ erase() æ–¹æ³•åˆ é™¤ vector ä¸­çš„å…ƒç´ ï¼š

```
myVector.erase(myVector.begin() + 2); // åˆ é™¤ç¬¬ä¸‰ä¸ªå…ƒç´ 
```

å¯ä»¥ä½¿ç”¨ clear() æ–¹æ³•æ¸…ç©º vector ä¸­çš„æ‰€æœ‰å…ƒç´ ï¼š

```
myVector.clear(); // æ¸…ç©º vector
```

ä»¥ä¸‹æ˜¯ä¸€ä¸ªå®Œæ•´çš„ä½¿ç”¨å®ä¾‹ï¼ŒåŒ…æ‹¬åˆ›å»º vectorã€æ·»åŠ å…ƒç´ ã€è®¿é—®å…ƒç´ ä»¥åŠè¾“å‡ºç»“æœçš„ä»£ç ï¼š

```c++
#include <iostream>
#include <vector>

int main() {
  // åˆ›å»ºä¸€ä¸ªç©ºçš„æ•´æ•°å‘é‡
  std::vector<int> myVector;

  // æ·»åŠ å…ƒç´ åˆ°å‘é‡ä¸­
  myVector.push_back(3);
  myVector.push_back(7);
  myVector.push_back(11);
  myVector.push_back(5);

  // è®¿é—®å‘é‡ä¸­çš„å…ƒç´ å¹¶è¾“å‡º
  std::cout << "Elements in the vector: ";
  for (int element : myVector) {
    std::cout << element << " ";
  }
  std::cout << std::endl;

  // è®¿é—®å‘é‡ä¸­çš„ç¬¬ä¸€ä¸ªå…ƒç´ å¹¶è¾“å‡º
  std::cout << "First element: " << myVector[0] << std::endl;

  // è®¿é—®å‘é‡ä¸­çš„ç¬¬äºŒä¸ªå…ƒç´ å¹¶è¾“å‡º
  std::cout << "Second element: " << myVector.at(1) << std::endl;

  // è·å–å‘é‡çš„å¤§å°å¹¶è¾“å‡º
  std::cout << "Size of the vector: " << myVector.size() << std::endl;

  // åˆ é™¤å‘é‡ä¸­çš„ç¬¬ä¸‰ä¸ªå…ƒç´ 
  myVector.erase(myVector.begin() + 2);

  // è¾“å‡ºåˆ é™¤å…ƒç´ åçš„å‘é‡
  std::cout << "Elements in the vector after erasing: ";
  for (int element : myVector) {
    std::cout << element << " ";
  }
  std::cout << std::endl;

  // æ¸…ç©ºå‘é‡å¹¶è¾“å‡º
  myVector.clear();
  std::cout << "Size of the vector after clearing: " << myVector.size() << std::endl;

  return 0;
}
```

ä»¥ä¸Šä»£ç åˆ›å»ºäº†ä¸€ä¸ªæ•´æ•°å‘é‡ï¼Œå‘å…¶ä¸­æ·»åŠ äº†å‡ ä¸ªå…ƒç´ ï¼Œç„¶åè¾“å‡ºäº†å‘é‡çš„å†…å®¹ã€å…ƒç´ çš„è®¿é—®ã€å‘é‡çš„å¤§å°ç­‰ä¿¡æ¯ï¼Œæ¥ç€åˆ é™¤äº†å‘é‡ä¸­çš„ç¬¬ä¸‰ä¸ªå…ƒç´ ï¼Œå¹¶è¾“å‡ºåˆ é™¤å…ƒç´ åçš„å‘é‡ã€‚æœ€åæ¸…ç©ºäº†å‘é‡ï¼Œå¹¶è¾“å‡ºæ¸…ç©ºåçš„å‘é‡å¤§å°ã€‚

è¾“å‡ºç»“æœä¸ºï¼š

```
Elements in the vector: 3 7 11 5 
First element: 3
Second element: 7
Size of the vector: 4
Elements in the vector after erasing: 3 7 5 
Size of the vector after clearing: 0
```

## 8. æ•°æ®ç»“æ„

é“¾è¡¨

```c++
struct Node {
    int data;
    Node* next;
};
Node* head = nullptr;
Node* newNode = new Node{10, nullptr};
head = newNode; // æ’å…¥æ–°èŠ‚ç‚¹
```

æ ˆ

```c++
stack<int> s;
s.push(1);
s.push(2);
cout << s.top(); // è¾“å‡º 2
s.pop();
```

é˜Ÿåˆ—

```c++
queue<int> q;
q.push(1);
q.push(2);
cout << q.front(); // è¾“å‡º 1
q.pop();
```

åŒç«¯é˜Ÿåˆ—

```c++
deque<int> dq;
dq.push_back(1);
dq.push_front(2);
cout << dq.front(); // è¾“å‡º 2
dq.pop_front();
```

å“ˆå¸Œè¡¨

```c++
unordered_map<string, int> hashTable;
hashTable["apple"] = 10;
cout << hashTable["apple"]; // è¾“å‡º 10
```

æ˜ å°„

```c++
map<string, int> myMap;
myMap["apple"] = 10;
cout << myMap["apple"]; // è¾“å‡º 10
```

é›†åˆ

```c++
set<int> s;
s.insert(1);
s.insert(2);
cout << *s.begin(); // è¾“å‡º 1
```

# é¢å‘å¯¹è±¡è®¾è®¡

```cpp
class Point3d {
public:
	Point3d(float x, float y, float z);
	print();
private:
	float x;
	float y;
	float z;
}

Point3d a(1,2,3);
a.print();
```

## ç¤ºä¾‹ï¼šTicketMachine

`TicketMachine.h`

```cpp
#ifndef CLASS_TICKETMACHINE_H
#define CLASS_TICKETMACHINE_H

class TicketMachine {
public:
    TicketMachine() ;
    virtual ~TicketMachine();
    
    void showPrompt();
    void insertMoney(int money);
    // ...
private:
    int balance
    // ...
};

#endif //CLASS_TICKETMACHINE_H

```

`TicketMachine`

```cpp
#include "ticketmachine.h"

TicketMachine::TicketMachine() {
    // TODO: Auto generated constructor stub
}

TicketMachine::~TicketMachine() {
    // TODO: Auto generated destructor stub
}

void TicketMachine::showPrompt(){
    std::cout << "Something..." << endl;
}

void TicketMachine::insertMoney(int money){
    balance += money;
}
```

> **ä½œç”¨åŸŸè§£æç¬¦ `::`** 	è®¿é—®æŸä¸ªå‘½åç©ºé—´æˆ–ç±»/ç»“æ„ä½“/æšä¸¾å†…çš„æˆå‘˜
>
>
> æ³¨æ„ï¼šå¯¹äºå˜é‡çš„å£°æ˜ï¼Œéœ€è¦åŠ ä¸Š**externå‰ç¼€**ï¼
>
> `int global`æ˜¯definitionï¼Œè€Œ`extern int global`æ‰æ˜¯declarationï¼

## 1. å¤´æ–‡ä»¶

`#ifndef CLASS_TICKETMACHINE_H`
`#define CLASS_TICKETMACHINE_H`
`#endif // CLASS_TICKETMACHINE_H`
å¤´æ–‡ä»¶ä¿æŠ¤ï¼Œ**é˜²æ­¢å¤´æ–‡ä»¶è¢«é‡å¤åŒ…å«è€Œå¯¼è‡´ç¼–è¯‘æŠ¥é”™**

å‡è®¾å·¥ç¨‹ä¸­æœ‰å¤šä¸ªæ–‡ä»¶ï¼š
```
A.cpp
B.cpp
TicketMachine.h
```

å¹¶ä¸” `A.cpp` å’Œ `B.cpp` éƒ½ include äº† `TicketMachine.h`ï¼š

è¿˜å¯èƒ½å½¼æ­¤ includeï¼Œ æ¯”å¦‚ï¼š
```
// A.cpp
#include "B.h"
#include "TicketMachine.h"

// B.h
#include "TicketMachine.h"
```

æ­¤æ—¶ä¼šæœ‰æŠ¥é”™ï¼š `error: redefinition of 'class TicketMachine'`ï¼Œå› ä¸º C++ ä¸å…è®¸ä¸€ä¸ªç±»ã€å‡½æ•°ã€å˜é‡åœ¨åŒä¸€ä¸ªç¼–è¯‘å•å…ƒè¢«é‡å¤å®šä¹‰

## 2. æˆå‘˜å˜é‡

```cpp
// A.cpp
// ...
class A {
public:
	int i;
private:
	void f(){
		i = 20;
		cout << i;
	}
}

// main.cpp
A a;
A aa;
a.i = 10;
aa.i = 100;
a.f();
aa.f();
```

**æˆå‘˜å˜é‡æ˜¯å±äºå¯¹è±¡çš„ï¼Œè€Œæ–¹æ³•æ˜¯å±äºç±»çš„**

åŒä¸€ç±»ä¸‹çš„æ‰€æœ‰å¯¹è±¡å„è‡ª**æ‹¥æœ‰è‡ªå·±çš„æˆå‘˜å˜é‡**ï¼Œä½†æ‰€æœ‰å¯¹è±¡**å…±ç”¨åŒæ ·çš„æ–¹æ³•**ï¼Œä¸è¿‡**æ–¹æ³•å¯ä»¥äº‹å…ˆå¾—çŸ¥å¯¹å“ªä¸ªå¯¹è±¡ä½¿ç”¨æ–¹æ³•ï¼ˆ`this`æŒ‡é’ˆï¼‰**

å®é™…ä¸Šï¼Œ`f()`åœ¨ç¼–è¯‘æ—¶ä¼šå˜æˆè¿™æ ·ï¼š

```cpp
void A::f(A* this){
    this.i = 10;
    cout << this.i;
}
```

## 3. æ„é€ ä¸ææ„

### constructor/destructor

æ„é€ å‡½æ•°ï¼Œåœ¨å¯¹è±¡â€œå‡ºç”Ÿâ€æ—¶è‡ªåŠ¨æ‰§è¡Œçš„å‡½æ•°ï¼Œè´Ÿè´£åˆå§‹åŒ–æˆå‘˜å˜é‡ã€åˆ†é…èµ„æºã€ç¡®ä¿å¯ç”¨ç­‰ã€‚

```cpp
TicketMachine::TicketMachine() {
    balance = 0;
}
```

```cpp
TicketMachine t;	// â† è¿™é‡Œè‡ªåŠ¨è°ƒç”¨æ„é€ å‡½æ•°
```

ææ„å‡½æ•°ï¼Œåœ¨å¯¹è±¡â€œæ­»äº¡/è¢«é”€æ¯â€æ—¶è‡ªåŠ¨æ‰§è¡Œçš„å‡½æ•°ï¼Œè´Ÿè´£é‡Šæ”¾èµ„æºï¼ˆå…³é—­æ–‡ä»¶ã€é‡Šæ”¾å†…å­˜ï¼‰

```cpp
TicketMachine::~TicketMachine() {
    // ...
}
```

```cpp
{						// è§„å®štçš„scope
    TicketMachine t;    // â† è¿™é‡Œæ„é€ 
}              			// â† ç¨‹åºå—ç»“æŸï¼Œè¿™é‡Œè‡ªåŠ¨ææ„
```

### é—®é¢˜ï¼šè·³è¿‡æŸäº›åˆå§‹åŒ–

```cpp
void f(){
	if(i < 10) goto jump1;
	X x1;
	
jump1:
	X x2;
}
```

è¿™é‡Œä¼šå‡ºç°é”™è¯¯ï¼Œå› ä¸º`x1` çš„å†…å­˜åˆ†é…å‘ç”Ÿåœ¨ç¨‹åº**è¿›å…¥å…¶ä½œç”¨åŸŸ**æ—¶ï¼ˆç¼–è¯‘å™¨é™æ€å†³å®šçš„ï¼‰ï¼Œè€Œæ„é€ éœ€è¦æ‰§è¡Œåˆ°`X x1`è¿™ä¸€å¥æ‰è¿›è¡Œã€‚ç„¶è€Œï¼Œå½“ç¨‹åºæ‰§è¡Œåˆ°ä½œç”¨åŸŸç»“å°¾æ—¶ï¼Œä¼šè°ƒç”¨æ‰€æœ‰è¯¥ä½œç”¨åŸŸé‡Œ**å·²åˆ†é…çš„å¯¹è±¡**çš„ææ„å‡½æ•°ï¼Œä½†**æœªæ„é€ çš„å¯¹è±¡æ˜¯ä¸èƒ½ææ„çš„ï¼**

### struct

**C è¯­è¨€ä¸­ struct ä¸èƒ½æœ‰æ„é€ å‡½æ•°**ï¼Œä½†åœ¨ **C++ ä¸­ struct å’Œ class æœ¬è´¨ä¸Šæ²¡æœ‰åŒºåˆ«**ã€‚

```cpp
struct Point {
    int x;
    int y;

    Point(int a, int b) {
        x = a;
        y = b;
    }
};
```

```cpp
Point p(3, 4);
```

## 4. è®¿é—®é™åˆ¶

### private

privateé‡Œçš„å˜é‡ä¸å…è®¸clientè®¿é—®ï¼Œæƒ³è¦è®¿é—®å¯ä»¥é€šè¿‡åœ¨publicé‡Œæ„é€ getå’Œsetå®Œæˆ

### å‹å…ƒ

**å‹å…ƒï¼ˆfriendï¼‰** æ˜¯ C++ ä¸­çš„ä¸€ä¸ªå…³é”®å­—ï¼Œç”¨æ¥ **è®©æŸä¸ªå‡½æ•°æˆ–æŸä¸ªç±»å¯ä»¥è®¿é—®æœ¬ç±»çš„ private / protected æˆå‘˜**ã€‚

```cpp
struct X; // å‰å‘å£°æ˜ï¼Œè®©ç¼–è¯‘é€šè¿‡
  
struct Y {
    void f(X*);
};

struct X{
private:
    int i;
public:
    void init();
    friend void g(X*, int);
    friend void Y::f(X*);
    friend struct Z;
    friend void h();
}
```

æ­¤æ—¶friendçš„æ–¹æ³•æˆ–ç±»å¯ä»¥ç›´æ¥è®¿é—®`X.i`

## 5. åˆå§‹åŒ–åˆ—è¡¨

åˆå§‹åŒ–åˆ—è¡¨ï¼ˆinitializer listï¼‰æ˜¯ C++ æ„é€ å‡½æ•°ä¸­çš„ä¸€ç§è¯­æ³•ï¼Œç”¨æ¥åœ¨æ„é€ å¯¹è±¡æ—¶ **ç›´æ¥åˆå§‹åŒ–æˆå‘˜å˜é‡**ï¼Œè€Œä¸æ˜¯åœ¨æ„é€ å‡½æ•°ä½“å†…è¿›è¡Œèµ‹å€¼ã€‚

```cpp
ClassName::ClassName(int a, int b) : x(a), y(b)   // â† åˆå§‹åŒ–åˆ—è¡¨
{
    // æ„é€ å‡½æ•°ä½“
}
```

æˆ–è€…æ˜¯ï¼š

```cpp
class A {
public:
    A(int v) : value(v) { }	// å½“å¯¹è±¡è¢«åˆ›å»ºæ—¶ï¼Œç”¨å‚æ•° v æ¥ç›´æ¥åˆå§‹åŒ– valueã€‚
private:
    int value;
};
```

**å’Œèµ‹å€¼çš„åŒºåˆ«**ï¼š

```cpp
Student::Student(string s):name(s) {}
Student::Student(string s){name = s;}
```

èµ‹å€¼å®é™…ä¸Šåšäº†ä¸¤ä»¶äº‹ï¼š**å…ˆåˆå§‹åŒ–ï¼Œç„¶åå†èµ‹å€¼**ã€‚è€Œåˆå§‹åŒ–åˆ—è¡¨åˆ™æ˜¯åœ¨å¯¹è±¡**è¢«åˆ†é…æ—¶ç«‹å³å¯¹å…¶èµ‹å€¼ï¼Œæ˜¯åœ¨constructorä¹‹å‰å®Œæˆçš„**

æœ‰äº›æˆå‘˜ **å¿…é¡»** ç”¨åˆå§‹åŒ–åˆ—è¡¨ï¼Œå¦åˆ™ç¼–è¯‘ä¸äº†

- `const`å˜é‡

  ```cpp
  class A {
      const int x;
  public:
      A(int v) : x(v) {}  // âœ” å¿…é¡»ç”¨åˆå§‹åŒ–åˆ—è¡¨
  };
  ```

- å¼•ç”¨å˜é‡
  ```cpp
  class A {
      int& r;
  public:
      A(int& x) : r(x) {}  // âœ” å¿…é¡»ç”¨åˆå§‹åŒ–åˆ—è¡¨
  };
  ```

- **æ²¡æœ‰é»˜è®¤æ„é€ å‡½æ•°çš„æˆå‘˜å¯¹è±¡**

  ```cpp
  class B {
  public:
      B(int x) {}
  };
  
  class A {
      B b;
  public:
      A() : b(10) {}  // âœ” å¿…é¡»æ˜¾å¼æ„é€ 
  };
  ```

  **æˆå‘˜å¯¹è±¡åœ¨è¿›å…¥æ„é€ å‡½æ•°ä½“ä¹‹å‰å°±å¿…é¡»â€œè¢«æ„é€ å‡ºæ¥â€**ï¼Œè€Œå¦‚æœè¿™ä¸ªæˆå‘˜å¯¹è±¡ **æ²¡æœ‰é»˜è®¤æ„é€ å‡½æ•°**ï¼Œç¼–è¯‘å™¨å°±ä¸çŸ¥é“åº”è¯¥æ€ä¹ˆâ€œå…ˆæ„é€ å®ƒâ€ï¼Œæ‰€ä»¥å°±å¿…é¡»ç”±ä½ åœ¨ **åˆå§‹åŒ–åˆ—è¡¨** ä¸­æ˜ç¡®å‘Šè¯‰ç¼–è¯‘å™¨ç”¨ä»€ä¹ˆæ„é€ æ–¹å¼æ¥æ„é€ è¿™ä¸ªæˆå‘˜ã€‚

  å‡è®¾ B åªæœ‰ä¸€ä¸ªå¸¦å‚æ•°çš„æ„é€ å‡½æ•°ï¼š

  ```cpp
  class B {
  public:
      B(int x);  // âœ” åªæœ‰è¿™ä¸ªæ„é€ å‡½æ•°
  };
  ```

  å®ƒ **æ²¡æœ‰é»˜è®¤æ„é€ å‡½æ•°**ã€‚

  ç°åœ¨ä½ å†™ï¼š

  ```cpp
  class A {
      B b; 
  public:
      A() { 
          // æƒ³åœ¨è¿™é‡Œèµ‹å€¼ï¼Ÿå¤ªæ™šäº†ï¼
          // b = B(10);  // âŒ ä¸å¯è¡Œ
      }
  };
  ```

  é—®é¢˜å‡ºç°ï¼š

  åœ¨ **è¿›å…¥ A() çš„æ„é€ å‡½æ•°ä½“ä¹‹å‰**ï¼Œç¼–è¯‘å™¨å¿…é¡»æŠŠ b æ„é€ å‡ºæ¥ã€‚

  ä½†ç¼–è¯‘å™¨å‘ç°ï¼š

  - B æ²¡æœ‰é»˜è®¤æ„é€ å‡½æ•°ï¼ˆB()ï¼‰
  - åˆæ²¡æœ‰åœ¨åˆå§‹åŒ–åˆ—è¡¨ä¸­å‘Šè¯‰å®ƒæ€ä¹ˆæ„é€  B

  äºæ˜¯ï¼š

  > ğŸ›‘ **ç¼–è¯‘é”™è¯¯ï¼šb æ— æ³•è¢«é»˜è®¤æ„é€ ã€‚**

## 5. å¯¹è±¡ç»„åˆ

ç»„åˆ = ä¸€ä¸ªç±»â€œæ‹¥æœ‰â€å¦ä¸€ä¸ªç±»ä½œä¸ºæˆå‘˜ã€‚

```cpp
class Engine {
public:
    Engine() { cout << "Engine constructed\n"; }
};

class Car {
private:
    Engine engine;  // Car ç»„åˆäº† Engine
public:
    Car() { cout << "Car constructed\n"; }
};
```

## 6.  æ‹·è´æ„é€ 

### æ‹·è´æ„é€ æ–¹æ³•

```cpp
static int objectcount = 0;

class HowMany {
public:
	HowMany() {objectcount++ ; print("HowMany()");}
	void print(const string& msg = "") {
		if(msg.size()!=0) count << msg << ":";
		cout << "objectcount = " << objectcount << endl;
	}
	~HowMany() {
		objectcount--;
		print("~HowMany()");
	}
}

HowMany f(HowMany x) {		// <- æ³¨æ„è¿™é‡Œä¼ çš„æ˜¯å¯¹è±¡è€Œä¸æ˜¯æŒ‡å‘å¯¹è±¡çš„æŒ‡é’ˆ
	cout << "begin of f" << endl;
	x.print("x argument inside f()");
	cout << "end of f" << endl;
	return x;
}

int main(){
	HowMany h;
	h.print("after construction of h");
	HowMany h2 = f(h);
	h.print("after call to f()");
}
```

è¾“å‡ºï¼š

```bash
HowMany(): objectcount = 1
after construction of h: objectcount = 1
begin of f
x argument inside f(): objectcount = 1
end of f
~HowMany(): objectcount = 0
after call to f(): objectcount = 0
~HowMany(): objectcount = -1
~HowMany(): objectcount = -2
```

æ³¨æ„åˆ°ï¼Œææ„å‡½æ•°è¢«è°ƒç”¨äº†ä¸‰æ¬¡ï¼Œè¯´æ˜åˆ›å»ºäº†ä¸‰ä¸ªå¯¹è±¡ï¼Œå…¶ä¸­åªæœ‰`h`æ˜¯æ­£å¸¸æ„é€ çš„ï¼ˆobj++ï¼‰ï¼›ç¨‹åºæ²¡æœ‰æŠ¥é”™ï¼Œè¯´æ˜`x`å’Œ`h2`è‚¯å®šæ˜¯è¢«æ„é€ äº†çš„ï¼Œåªæ˜¯æ²¡æœ‰èµ°è¿‡è§„å®šçš„æ„é€ å‡½æ•°ã€‚

é‚£å¦‚æœè¿™æ ·æ”¹å‘¢ï¼š

```cpp
HowMany h2 = h;
```

ç»“æœï¼š

```bash
HowMany(): objectcount = 1
after construction of h: objectcount = 1
after call to f(): objectcount = 1
~HowMany(): objectcount = 0
~HowMany(): objectcount = -1
```

è¿˜æ˜¯æ²¡æœ‰ç»è¿‡æˆ‘ä»¬çš„æ„é€ å‡½æ•°

é‚£è¿™æ ·å‘¢ï¼ŒåŠ ä¸€ä¸ªæ„é€ å‡½æ•°`HowMany(const HowMany& o)`

```cpp
HowMany(const HowMany& o){ objectcount++ ; print("HowMany(HM)");}
```

æ­¤æ—¶çš„è¾“å‡º:

```bash
HowMany(): objectcount = 1
after construction of h: objectcount = 1
HowMany(HM): objectcount = 2
after call to f(): objectcount = 2
~HowMany(): objectcount = 1
~HowMany(): objectcount = 0
```

æ­£å¸¸äº†ï¼è¯´æ˜æ­¤æ—¶`HowMany h2 = h`è¿™ä¸€å¥åœ¨æ„é€ æ—¶ç»è¿‡äº†`HowMany(const HowMany& o)`è¿™ä¸ªæ„é€ æ–¹æ³•ï¼

é‚£æ­¤æ—¶æˆ‘ä»¬å†å›å¤`HowMany h2 = f(h)`ï¼Œæ­¤æ—¶çš„è¾“å‡ºï¼š

```bash
HowMany(): objectcount = 1
after construction of h: objectcount = 1
HowMany(HM): objectcount = 2
begin of f
x argument inside f(): objectcount = 1
end of f
HowMany(HM): objectcount = 3
~HowMany(): objectcount = 2
after call to f(): objectcount = 2
~HowMany(): objectcount = 1
~HowMany(): objectcount = 0
```

å½¢å¦‚`T::T(const T&)`çš„æ„é€ æ–¹æ³•å°±æ˜¯**æ‹·è´æ„é€ **ã€‚

å¦‚æœæ²¡æœ‰æ˜¾å¼åœ°ç»™å‡ºæ‹·è´æ–¹æ³•ï¼Œc++ä¼šè‡ªåŠ¨å¸®ä½ è¡¥å……ä¸€ä¸ªã€‚

### æµ…æ‹·è´ä¸æ·±æ‹·è´

ç¼–è¯‘å™¨ä¼šæ‹·è´æ¯ä¸ªæˆå‘˜å˜é‡ï¼ŒåŒ…æ‹¬å¯¹è±¡ï¼›**æ‹·è´å¯¹è±¡æ—¶ï¼Œä¼šè®©é‚£ä¸ªç±»çš„æ‹·è´æ„é€ æ–¹æ³•æ¥æ‹·è´æ„é€ é‚£ä¸ªå¯¹è±¡**ï¼›å¦‚æœè¢«æ‹·è´çš„å¯¹è±¡é‡Œæœ‰å…¶ä»–çš„å¯¹è±¡ï¼Œè¿™ä¸ªæ„é€ ä¼š**é€’å½’åœ°è¿›è¡Œä¸‹å»**ã€‚

è¿™æ˜¯**åœ¨æˆå‘˜çº§åˆ«ä¸Šçš„æ‹·è´ï¼Œè€Œä¸æ˜¯å­—èŠ‚çº§åˆ«çš„æ‹·è´**ï¼Œæ‹·è´çš„åŸºæœ¬å•ä½æ˜¯æˆå‘˜ï¼Œè€Œä¸æ˜¯æŒ‰å­—èŠ‚ä¸€ä¸ªä¸€ä¸ªå¤åˆ¶è¿‡æ¥ã€‚

å¦‚æœæˆå‘˜æœ‰æŒ‡é’ˆï¼Œä¼šå‘ç”ŸæŒ‡é’ˆçš„æ‹·è´ï¼Œè¿™**ä¸¤ä¸ªæŒ‡é’ˆä¼šæŒ‡å‘åŒä¸€å˜é‡**ï¼›åŒç†å¦‚æœæœ‰referenceçš„è¯ï¼Œè¿™ä¸¤ä¸ªreferenceä¼šæ†ç»‘åŒä¸€ä¸ªå˜é‡ã€‚

ä»¥ä¸Šï¼Œå°±æ˜¯**æµ…æ‹·è´**ï¼Œæ‹·è´æŒ‡é’ˆæ—¶ï¼Œä¸¤ä¸ªå¯¹è±¡çš„æŒ‡é’ˆæŒ‡å‘åŒä¸€å—å†…å­˜ï¼Œæ²¡æœ‰ä»»ä½•â€œæ–°å†…å­˜â€è¢«åˆ†é…ã€‚

```
æ–°å¯¹è±¡.p = æ—§å¯¹è±¡.p   ï¼ˆæŒ‡é’ˆçš„åœ°å€è¢«ç›´æ¥å¤åˆ¶ï¼‰
```

è€Œ**æ·±æ‹·è´**ï¼Œå°±æ˜¯**å¤åˆ¶æŒ‡é’ˆæ‰€æŒ‡å‘çš„å†…å®¹ï¼Œåˆ†é…æ–°å†…å­˜ï¼Œè®©ä¸¤ä¸ªå¯¹è±¡äº’ä¸å½±å“**

```
æ–°å¯¹è±¡.p = new int(*æ—§å¯¹è±¡.p)
```

```cpp
Person::Person(const Person& w){
    name = new char[::strlen(w.name)+1];
    ::strcpy(name, w.name);
}
```

ä¸ºnameåˆ†é…äº†æ–°çš„å†…å­˜ï¼Œè¿™æ˜¯æ·±æ‹·è´

> ä¹‹å‰è¯´ï¼Œæ–¹æ³•æ˜¯å±äºç±»çš„ï¼ŒåŒä¸ºPersonç±»ï¼Œè¿™é‡Œæ˜¯å¯ä»¥ç›´æ¥è®¿é—®w.nameçš„

## 7. å·¦å€¼å¼•ç”¨ä¸å³å€¼å¼•ç”¨

### å·¦å€¼å¼•ç”¨

å…ˆçœ‹ä¸€ä¸‹ä¼ ç»Ÿçš„å·¦å€¼å¼•ç”¨ã€‚

```cpp
int a = 10;
int &b = a;  // å®šä¹‰ä¸€ä¸ªå·¦å€¼å¼•ç”¨å˜é‡
b = 20;      // é€šè¿‡å·¦å€¼å¼•ç”¨ä¿®æ”¹å¼•ç”¨å†…å­˜çš„å€¼
```

*å·¦å€¼å¼•ç”¨åœ¨æ±‡ç¼–å±‚é¢å…¶å®å’Œæ™®é€šçš„æŒ‡é’ˆæ˜¯ä¸€æ ·çš„ï¼›*å®šä¹‰å¼•ç”¨å˜é‡å¿…é¡»åˆå§‹åŒ–ï¼Œå› ä¸ºå¼•ç”¨å…¶å®å°±æ˜¯ä¸€ä¸ªåˆ«åï¼Œéœ€è¦å‘Šè¯‰ç¼–è¯‘å™¨å®šä¹‰çš„æ˜¯è°çš„å¼•ç”¨ã€‚

```cpp
int &var = 10;
```

ä¸Šè¿°ä»£ç æ˜¯æ— æ³•ç¼–è¯‘é€šè¿‡çš„ï¼Œå› ä¸º10æ— æ³•è¿›è¡Œå–åœ°å€æ“ä½œï¼Œæ— æ³•å¯¹ä¸€ä¸ªç«‹å³æ•°å–åœ°å€ï¼Œå› ä¸ºç«‹å³æ•°å¹¶æ²¡æœ‰åœ¨å†…å­˜ä¸­å­˜å‚¨ï¼Œè€Œæ˜¯å­˜å‚¨åœ¨å¯„å­˜å™¨ä¸­ï¼Œå¯ä»¥é€šè¿‡ä¸‹è¿°æ–¹æ³•è§£å†³ï¼š

```cpp
const int &var = 10;
```

ä½¿ç”¨å¸¸å¼•ç”¨æ¥å¼•ç”¨å¸¸é‡æ•°å­—10ï¼Œå› ä¸ºæ­¤åˆ»å†…å­˜ä¸Šäº§ç”Ÿäº†ä¸´æ—¶å˜é‡ä¿å­˜äº†10ï¼Œè¿™ä¸ªä¸´æ—¶å˜é‡æ˜¯å¯ä»¥è¿›è¡Œå–åœ°å€æ“ä½œçš„ï¼Œå› æ­¤varå¼•ç”¨çš„å…¶å®æ˜¯è¿™ä¸ªä¸´æ—¶å˜é‡ï¼Œç›¸å½“äºä¸‹é¢çš„æ“ä½œï¼š

```cpp
const int temp = 10; 
const int &var = temp;
```

æ ¹æ®ä¸Šè¿°åˆ†æï¼Œå¾—å‡ºå¦‚ä¸‹ç»“è®ºï¼š

- å·¦å€¼å¼•ç”¨è¦æ±‚å³è¾¹çš„å€¼å¿…é¡»èƒ½å¤Ÿå–åœ°å€ï¼Œå¦‚æœæ— æ³•å–åœ°å€ï¼Œå¯ä»¥ç”¨å¸¸å¼•ç”¨ï¼›
  ä½†ä½¿ç”¨å¸¸å¼•ç”¨åï¼Œæˆ‘ä»¬åªèƒ½é€šè¿‡å¼•ç”¨æ¥è¯»å–æ•°æ®ï¼Œæ— æ³•å»ä¿®æ”¹æ•°æ®ï¼Œå› ä¸ºå…¶è¢«constä¿®é¥°æˆå¸¸é‡å¼•ç”¨äº†ã€‚

é‚£ä¹ˆ[C++11](https://zhida.zhihu.com/search?content_id=109714504&content_type=Article&match_order=1&q=C%2B%2B11&zhida_source=entity) å¼•å…¥äº†[å³å€¼å¼•ç”¨](https://zhida.zhihu.com/search?content_id=109714504&content_type=Article&match_order=1&q=å³å€¼å¼•ç”¨&zhida_source=entity)çš„æ¦‚å¿µï¼Œä½¿ç”¨å³å€¼å¼•ç”¨èƒ½å¤Ÿå¾ˆå¥½çš„è§£å†³è¿™ä¸ªé—®é¢˜ã€‚

### å³å€¼å¼•ç”¨

C++å¯¹äºå·¦å€¼å’Œå³å€¼æ²¡æœ‰æ ‡å‡†å®šä¹‰ï¼Œä½†æ˜¯æœ‰ä¸€ä¸ªè¢«å¹¿æ³›è®¤åŒçš„è¯´æ³•ï¼š

- å¯ä»¥å–åœ°å€çš„ï¼Œæœ‰åå­—çš„ï¼Œéä¸´æ—¶çš„å°±æ˜¯å·¦å€¼ï¼›
- ä¸èƒ½å–åœ°å€çš„ï¼Œæ²¡æœ‰åå­—çš„ï¼Œä¸´æ—¶çš„å°±æ˜¯å³å€¼ï¼›

å¯è§ç«‹å³æ•°ï¼Œå‡½æ•°è¿”å›çš„å€¼ç­‰éƒ½æ˜¯å³å€¼ï¼›è€ŒéåŒ¿åå¯¹è±¡(åŒ…æ‹¬å˜é‡)ï¼Œå‡½æ•°è¿”å›çš„å¼•ç”¨ï¼Œconstå¯¹è±¡ç­‰éƒ½æ˜¯å·¦å€¼ã€‚

ä»æœ¬è´¨ä¸Šç†è§£ï¼Œåˆ›å»ºå’Œé”€æ¯ç”±ç¼–è¯‘å™¨å¹•åæ§åˆ¶ï¼Œç¨‹åºå‘˜åªèƒ½ç¡®ä¿åœ¨æœ¬è¡Œä»£ç æœ‰æ•ˆçš„ï¼Œå°±æ˜¯å³å€¼(åŒ…æ‹¬ç«‹å³æ•°)ï¼›è€Œç”¨æˆ·åˆ›å»ºçš„ï¼Œé€šè¿‡ä½œç”¨åŸŸè§„åˆ™å¯çŸ¥å…¶ç”Ÿå­˜æœŸçš„ï¼Œå°±æ˜¯å·¦å€¼(åŒ…æ‹¬å‡½æ•°è¿”å›çš„å±€éƒ¨å˜é‡çš„å¼•ç”¨ä»¥åŠconstå¯¹è±¡)ã€‚

å®šä¹‰å³å€¼å¼•ç”¨çš„æ ¼å¼å¦‚ä¸‹ï¼š

```text
ç±»å‹ && å¼•ç”¨å = å³å€¼è¡¨è¾¾å¼;
```

å³å€¼å¼•ç”¨æ˜¯C++ 11æ–°å¢çš„ç‰¹æ€§ï¼Œæ‰€ä»¥C++ 98çš„å¼•ç”¨ä¸ºå·¦å€¼å¼•ç”¨ã€‚å³å€¼å¼•ç”¨ç”¨æ¥ç»‘å®šåˆ°å³å€¼ï¼Œç»‘å®šåˆ°å³å€¼ä»¥åæœ¬æ¥ä¼šè¢«é”€æ¯çš„å³å€¼çš„ç”Ÿå­˜æœŸä¼šå»¶é•¿è‡³ä¸ç»‘å®šåˆ°å®ƒçš„å³å€¼å¼•ç”¨çš„ç”Ÿå­˜æœŸã€‚

```text
int &&var = 10;
```

åœ¨æ±‡ç¼–å±‚é¢å³å€¼å¼•ç”¨åšçš„äº‹æƒ…å’Œå¸¸å¼•ç”¨æ˜¯ç›¸åŒçš„ï¼Œå³äº§ç”Ÿä¸´æ—¶é‡æ¥å­˜å‚¨å¸¸é‡ã€‚ä½†æ˜¯ï¼Œå”¯ä¸€ ä¸€ç‚¹çš„åŒºåˆ«æ˜¯ï¼Œå³å€¼å¼•ç”¨å¯ä»¥è¿›è¡Œè¯»å†™æ“ä½œï¼Œè€Œå¸¸å¼•ç”¨åªèƒ½è¿›è¡Œè¯»æ“ä½œã€‚

å³å€¼å¼•ç”¨çš„å­˜åœ¨å¹¶ä¸æ˜¯ä¸ºäº†å–ä»£å·¦å€¼å¼•ç”¨ï¼Œè€Œæ˜¯å……åˆ†åˆ©ç”¨å³å€¼(ç‰¹åˆ«æ˜¯ä¸´æ—¶å¯¹è±¡)çš„æ„é€ æ¥å‡å°‘å¯¹è±¡æ„é€ å’Œææ„æ“ä½œä»¥è¾¾åˆ°æé«˜æ•ˆç‡çš„ç›®çš„ã€‚

ç”¨C++å®ç°ä¸€ä¸ªç®€å•çš„é¡ºåºæ ˆï¼š

```cpp
class Stack
{
public:
    // æ„é€ 
    Stack(int size = 1000) 
	:msize(size), mtop(0)
    {
	cout << "Stack(int)" << endl;
	mpstack = new int[size];
    }
	
    // ææ„
    ~Stack()
    {
	cout << "~Stack()" << endl;
	delete[]mpstack;
	mpstack = nullptr;
    }
	
    // æ‹·è´æ„é€ 
    Stack(const Stack &src)
	:msize(src.msize), mtop(src.mtop)
    {
	cout << "Stack(const Stack&)" << endl;
	mpstack = new int[src.msize];
	for (int i = 0; i < mtop; ++i) {
	    mpstack[i] = src.mpstack[i];
	}
    }
	
    // èµ‹å€¼é‡è½½
    Stack& operator=(const Stack &src)
    {
	cout << "operator=" << endl;
	if (this == &src)
     	    return *this;

	delete[]mpstack;

	msize = src.msize;
	mtop = src.mtop;
	mpstack = new int[src.msize];
	for (int i = 0; i < mtop; ++i) {
	    mpstack[i] = src.mpstack[i];
	}
	return *this;
    }

    int getSize() 
    {
	return msize;
    }
private:
    int *mpstack;
    int mtop;
    int msize;
};

Stack GetStack(Stack &stack)
{
    Stack tmp(stack.getSize());
    return tmp;
}

int main()
{
    Stack s;
    s = GetStack(s);
    return 0;
}
```

è¿è¡Œç»“æœå¦‚ä¸‹ï¼š

```cpp
Stack(int)             // æ„é€ s
Stack(int)             // æ„é€ tmp
Stack(const Stack&)    // tmpæ‹·è´æ„é€ mainå‡½æ•°æ ˆå¸§ä¸Šçš„ä¸´æ—¶å¯¹è±¡
~Stack()               // tmpææ„
operator=              // ä¸´æ—¶å¯¹è±¡èµ‹å€¼ç»™s
~Stack()               // ä¸´æ—¶å¯¹è±¡ææ„
~Stack()               // sææ„
```

ä¸ºäº†è§£å†³æµ…æ‹·è´é—®é¢˜ï¼Œä¸ºç±»æä¾›äº†è‡ªå®šä¹‰çš„æ‹·è´æ„é€ å‡½æ•°å’Œèµ‹å€¼è¿ç®—ç¬¦é‡è½½å‡½æ•°ï¼Œå¹¶ä¸”è¿™ä¸¤ä¸ªå‡½æ•°å†…éƒ¨å®ç°éƒ½æ˜¯éå¸¸çš„è€—è´¹æ—¶é—´å’Œèµ„æº(é¦–å…ˆå¼€è¾Ÿè¾ƒå¤§çš„ç©ºé—´ï¼Œç„¶åå°†æ•°æ®é€ä¸ªå¤åˆ¶)ï¼Œæˆ‘ä»¬é€šè¿‡ä¸Šè¿°è¿è¡Œç»“æœå‘ç°äº†ä¸¤å¤„ä½¿ç”¨äº†æ‹·è´æ„é€ å’Œèµ‹å€¼é‡è½½ï¼Œåˆ†åˆ«æ˜¯tmpæ‹·è´æ„é€ mainå‡½æ•°æ ˆå¸§ä¸Šçš„ä¸´æ—¶å¯¹è±¡ã€ä¸´æ—¶å¯¹è±¡èµ‹å€¼ç»™sï¼Œå…¶ä¸­tmpå’Œä¸´æ—¶å¯¹è±¡éƒ½åœ¨å„è‡ªçš„æ“ä½œç»“æŸåä¾¿é”€æ¯äº†ï¼Œä½¿å¾—ç¨‹åºæ•ˆç‡éå¸¸ä½ä¸‹ã€‚

é‚£ä¹ˆæˆ‘ä»¬ä¸ºäº†æé«˜æ•ˆç‡ï¼Œæ˜¯å¦å¯ä»¥æŠŠtmpæŒæœ‰çš„å†…å­˜èµ„æºç›´æ¥ç»™ä¸´æ—¶å¯¹è±¡ï¼Ÿæ˜¯å¦å¯ä»¥æŠŠä¸´æ—¶å¯¹è±¡çš„èµ„æºç›´æ¥ç»™sï¼Ÿ

åœ¨C++11ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥è§£å†³ä¸Šè¿°é—®é¢˜ï¼Œæ–¹å¼æ˜¯æä¾›å¸¦å³å€¼å¼•ç”¨å‚æ•°çš„æ‹·è´æ„é€ å‡½æ•°å’Œèµ‹å€¼è¿ç®—ç¬¦é‡è½½å‡½æ•°.

```cpp
// å¸¦å³å€¼å¼•ç”¨å‚æ•°çš„æ‹·è´æ„é€ å‡½æ•°
Stack(Stack &&src)
    :msize(src.msize), mtop(src.mtop)
{
    cout << "Stack(Stack&&)" << endl;

    /*æ­¤å¤„æ²¡æœ‰é‡æ–°å¼€è¾Ÿå†…å­˜æ‹·è´æ•°æ®ï¼ŒæŠŠsrcçš„èµ„æºç›´æ¥ç»™å½“å‰å¯¹è±¡ï¼Œå†æŠŠsrcç½®ç©º*/
    mpstack = src.mpstack;  
    src.mpstack = nullptr;
}

// å¸¦å³å€¼å¼•ç”¨å‚æ•°çš„èµ‹å€¼è¿ç®—ç¬¦é‡è½½å‡½æ•°
Stack& operator=(Stack &&src)
{
    cout << "operator=(Stack&&)" << endl;

    if(this == &src)
        return *this;
	    
    delete[]mpstack;

    msize = src.msize;
    mtop = src.mtop;

    /*æ­¤å¤„æ²¡æœ‰é‡æ–°å¼€è¾Ÿå†…å­˜æ‹·è´æ•°æ®ï¼ŒæŠŠsrcçš„èµ„æºç›´æ¥ç»™å½“å‰å¯¹è±¡ï¼Œå†æŠŠsrcç½®ç©º*/
    mpstack = src.mpstack;
    src.mpstack = nullptr;

    return *this;
}
```

è¿è¡Œç»“æœå¦‚ä¸‹ï¼š

```cpp
Stack(int)             // æ„é€ s
Stack(int)             // æ„é€ tmp
Stack(Stack&&)         // è°ƒç”¨å¸¦å³å€¼å¼•ç”¨çš„æ‹·è´æ„é€ å‡½æ•°ï¼Œç›´æ¥å°†tmpçš„èµ„æºç»™ä¸´æ—¶å¯¹è±¡
~Stack()               // tmpææ„
operator=(Stack&&)     // è°ƒç”¨å¸¦å³å€¼å¼•ç”¨çš„èµ‹å€¼è¿ç®—ç¬¦é‡è½½å‡½æ•°ï¼Œç›´æ¥å°†ä¸´æ—¶å¯¹è±¡èµ„æºç»™s
~Stack()               // ä¸´æ—¶å¯¹è±¡ææ„
~Stack()               // sææ„
```

ç¨‹åºè‡ªåŠ¨è°ƒç”¨äº†å¸¦å³å€¼å¼•ç”¨çš„æ‹·è´æ„é€ å‡½æ•°å’Œèµ‹å€¼è¿ç®—ç¬¦é‡è½½å‡½æ•°ï¼Œä½¿å¾—ç¨‹åºçš„æ•ˆç‡å¾—åˆ°äº†å¾ˆå¤§çš„æå‡ï¼Œå› ä¸ºå¹¶æ²¡æœ‰é‡æ–°å¼€è¾Ÿå†…å­˜æ‹·è´æ•°æ®ã€‚

å¯ä»¥ç›´æ¥èµ‹å€¼çš„åŸå› æ˜¯ä¸´æ—¶å¯¹è±¡å³å°†é”€æ¯ï¼Œä¸ä¼šå‡ºç°æµ…æ‹·è´çš„é—®é¢˜ï¼Œæˆ‘ä»¬ç›´æ¥æŠŠä¸´æ—¶å¯¹è±¡æŒæœ‰çš„èµ„æºèµ‹ç»™æ–°å¯¹è±¡å°±å¯ä»¥äº†ã€‚

ä¸Šé¢è¯´çš„æ„é€ æ–¹æ³•ï¼Œå°±æ˜¯**ç§»åŠ¨æ„é€ **ï¼Œå³**å·**å³å€¼å¯¹è±¡çš„èµ„æºï¼ˆå¦‚å†…å­˜æŒ‡é’ˆï¼‰ï¼Œå†æŠŠåŸå¯¹è±¡çš„æŒ‡é’ˆç½®ç©ºï¼Œé¿å… double delete.

æ­¤å¤–ï¼Œè¿˜æœ‰**ç§»åŠ¨èµ‹å€¼**ï¼š

```cpp
MyArray& operator=(MyArray&& other) {
    size = other.size;
    arr = other.arr;
    other.arr = NULL;
    return *this;
}
```

è€Œ`std::move`çš„ä½œç”¨ï¼Œå°±æ˜¯æŠŠå·¦å€¼æ˜¾å¼è½¬æ¢æˆå³å€¼å¼•ç”¨ï¼Œä»è€Œè§¦å‘ç§»åŠ¨è¯­ä¹‰ã€‚

## 8. åŠ¨æ€å†…å­˜ä¸åŠ¨æ€å¯¹è±¡

### new å’Œ delete

| è¯­è¨€ | ç”³è¯·     | é‡Šæ”¾   | è°ƒç”¨æ„é€ /ææ„ï¼Ÿ              |
| ---- | -------- | ------ | ---------------------------- |
| C    | malloc() | free() | âŒ ä¸ä¼šè°ƒç”¨æ„é€ å‡½æ•°/ææ„å‡½æ•°  |
| C++  | new      | delete | âœ” è‡ªåŠ¨è°ƒç”¨æ„é€ å‡½æ•°ä¸ææ„å‡½æ•° |

```c
p = (A*) malloc(sizeof(A));  // malloc ä¸è°ƒç”¨æ„é€ å‡½æ•°
free(p);                     // free ä¸è°ƒç”¨ææ„å‡½æ•°
```

```c
A* p = new A;   // è°ƒç”¨ A() æ„é€ å‡½æ•°
delete p;       // è°ƒç”¨ ~A() ææ„å‡½æ•°
```

**new çš„è¡Œä¸º**ï¼š

1. åœ¨ heap ä¸Šç”³è¯· sizeof(A) çš„å†…å­˜

2. è°ƒç”¨ A çš„æ„é€ å‡½æ•°åˆå§‹åŒ–é‚£å—å†…å­˜

3. è¿”å›è¿™å—å¯¹è±¡çš„åœ°å€ï¼ˆæŒ‡å‘ heap å¯¹è±¡çš„æŒ‡é’ˆï¼‰

åŠ¨æ€å¯¹è±¡å°±æ˜¯**é€šè¿‡ new åœ¨å †ä¸Šåˆ›å»ºçš„å¯¹è±¡**

### åŠ¨æ€å¯¹è±¡æ•°ç»„

```cpp
A* p;
p = new A[100];   // è°ƒç”¨100æ¬¡é»˜è®¤æ„é€ 
delete [] p;      // è°ƒç”¨100æ¬¡ææ„ + é‡Šæ”¾æ•°ç»„
```

æ•°ç»„åˆ é™¤å¿…é¡»å†™ `delete [] p;`ï¼ˆä¸èƒ½çœç•¥æ–¹æ‹¬å·ï¼‰

ç±»è¦æœ‰ **é»˜è®¤æ„é€ å‡½æ•°** æ‰èƒ½ `new A[100]`

**åŠ¨æ€äºŒç»´æ•°ç»„**ï¼š

```cpp
char** chArray2 = new char*[ROWS];

for(int row = 0; row < ROWS; row++)
    chArray2[row] = new char[COLUMNS];
```

é‡Šæ”¾ï¼š

```cpp
for(int row = 0; row < ROWS; row++) {
    delete [] chArray2[row];
    chArray2[row] = NULL;
}
delete [] chArray2;
chArray2 = NULL;
```

## 9. Const

### Constæˆå‘˜

å°†**`const`**ä¿®é¥°çš„â€œæˆå‘˜å‡½æ•°â€ç§°ä¹‹ä¸ºconstæˆå‘˜å‡½æ•°ï¼Œconstä¿®é¥°ç±»æˆå‘˜å‡½æ•°ï¼Œå®é™…ä¿®é¥°è¯¥æˆå‘˜å‡½æ•°éšå«çš„**thisæŒ‡é’ˆ**ï¼Œ**è¡¨æ˜åœ¨è¯¥æˆå‘˜å‡½æ•°ä¸­ä¸èƒ½å¯¹ç±»çš„ä»»ä½•æˆå‘˜è¿›è¡Œä¿®æ”¹** 

```cpp
class Date
{
public:
	//æ„é€ å‡½æ•°
	Date(int year, int month, int day)
	{
		_year = year;
		_month = month;
		_day = day;
	}
	void Printf()
	{
		cout << _year << "å¹´" << _month << "æœˆ" << _day << "æ—¥" << endl;
	}
private:
	int _year;
	int _month;
	int _day;
};
 
void Func(const Date& d)
{
	d.Printf();
}
 
int main()
{
	Date d1(2023, 11, 1);
	d1.Printf();
	Date d2(2023, 11, 2);
	Func(d2);
	return 0;
}
```

æ­¤æ—¶`d1`ä¸ä¼šæŠ¥é”™ï¼Œä½†`Func(d2)`é‡Œçš„`d.print()`ä¼šæŠ¥é”™ï¼Œæ€ä¹ˆå›äº‹å‘¢ï¼Ÿ

`Printf()`éšå«çš„é»˜è®¤`this`æŒ‡é’ˆæ˜¯`void Printf(Date* const this)`ï¼Œè¿™é‡Œ`this`æŒ‡é’ˆæ˜¯`Date*`ç±»å‹çš„

è€Œæˆ‘ä¼ å…¥çš„æ˜¯`const Date*` ç±»å‹ï¼Œä¼ å…¥çš„è¿‡ç¨‹ä¸­æƒé™è¢«æ‰©å¤§äº†ï¼

å¯ä»¥è¿™æ ·ä¿®æ”¹ï¼š

```cpp
	void Printf() const	// ç¼–è¯‘å™¨é»˜è®¤å¤„ç†æˆï¼švoid Print(const Date* const this)
	{
		cout << _year << "å¹´" << _month << "æœˆ" << _day << "æ—¥" << endl;
	}
```

è¿™æ ·æƒé™ä¸å˜ï¼Œå°±ä¸ä¼šæŠ¥é”™äº†

**constå¯¹è±¡ä¸èƒ½è°ƒç”¨éconstæˆå‘˜å‡½æ•°ï¼Œéconstå¯¹è±¡å¯ä»¥è°ƒç”¨constæˆå‘˜å‡½æ•°ï¼Œconstæˆå‘˜å‡½æ•°å†…ä¸èƒ½è°ƒç”¨å…¶å®ƒçš„éconstæˆå‘˜å‡½æ•°ï¼Œéconstæˆå‘˜å‡½æ•°å†…å¯ä»¥è°ƒç”¨å…¶å®ƒçš„constæˆå‘˜å‡½æ•°**

å¦‚æœconst æˆå‘˜å‡½æ•°ä¸­æƒ³ä¿®æ”¹â€œå†…éƒ¨çŠ¶æ€â€ï¼Œå¯ä»¥ä½¿ç”¨mutable

```cpp
struct Fib {
    Fib(int n) : n_(n) {}
    int value() const {
        if (!cached) {
            cache  = fib(n_);
            cached = true;
        }
        return cache;
    }

    int n_;
    mutable bool cached = false;
    mutable int  cache  = 0;
};
```

const æˆå‘˜å‡½æ•°ç†è®ºä¸Šä¸èƒ½ä¿®æ”¹æˆå‘˜å˜é‡ï¼Œä½†â€œç¼“å­˜â€å±äºå†…éƒ¨å®ç°ç»†èŠ‚ï¼Œä¸å½±å“å¯¹è±¡çš„é€»è¾‘å¤–éƒ¨çŠ¶æ€ï¼Œæ‰€ä»¥ç”¨ `mutable` è®©è¿™ä¸¤ä¸ªæˆå‘˜åœ¨ const å‡½æ•°é‡Œå¯ä»¥ä¿®æ”¹

### Constè¡¨è¾¾å¼

constexpr ä¿®é¥°å‡½æ•°ï¼š

- å¦‚æœä¼ å…¥å¸¸é‡è¡¨è¾¾å¼ â†’ åœ¨ç¼–è¯‘æœŸè®¡ç®—
- å¦åˆ™ â†’ åœ¨è¿è¡ŒæœŸè®¡ç®—ï¼Œä¹Ÿåˆæ³•

```cpp
constexpr int sqr(int x) { return x * x; }

constexpr int A = sqr(10);  // ç¼–è¯‘æœŸè®¡ç®—
int y = 3;
int B = sqr(y);             // è¿è¡ŒæœŸè®¡ç®—
```

constevalï¼š

- å¿…é¡»åœ¨ç¼–è¯‘æœŸæ±‚å€¼ï¼Œè°ƒç”¨ç‚¹ä¸æ˜¯å¸¸é‡è¡¨è¾¾å¼å°±æŠ¥é”™

```cpp
consteval int pow2(int n) { return 1 << n; }

constexpr int M = pow2(8);    // âœ” OK
int r = pow2(y);              // âŒ yä¸æ˜¯å¸¸é‡è¡¨è¾¾å¼ â†’ ç¼–è¯‘é”™è¯¯
```

## 10. é™æ€æˆå‘˜

ç±»åˆ»ç”»äº†ä¸€ç»„å…·æœ‰ç›¸åŒå±æ€§çš„å¯¹è±¡
é—®é¢˜ï¼š**åŒä¸€ä¸ªç±»çš„ä¸åŒå¯¹è±¡å¦‚ä½•å…±äº«å˜é‡**ï¼Ÿ

- å¦‚æœæŠŠè¿™äº›å…±äº«å˜é‡å®šä¹‰ä¸ºå…¨å±€å˜é‡ â†’ ç¼ºä¹æ•°æ®ä¿æŠ¤ï¼Œåæ±¡æŸ“

```cpp
class A {
    int x, y;
    static int shared;
};
int A::shared = 0;
A a, b;
```

> â—é™æ€æˆå‘˜å˜é‡çš„å®šä¹‰å¿…é¡»åœ¨ç±»å¤–å†å†™ä¸€éï¼š`int A::shared = 0;`
>
> æˆ–è€…`inline static int shared = 0;`ï¼ˆC++17ï¼‰

**é™æ€æˆå‘˜å‡½æ•°**

```cpp
class A {
    static int shared;
    int x;
public:
    static void f() { â€¦ shared â€¦ }
    void q() { â€¦ x â€¦ shared â€¦ }
};
```

é™æ€æˆå‘˜å‡½æ•°**æ²¡æœ‰ this æŒ‡é’ˆ**ï¼Œå› æ­¤ **ä¸èƒ½è®¿é—®éé™æ€æˆå‘˜å˜é‡**ï¼ˆä¾‹å¦‚ xï¼‰ï¼Œä½†å¯ä»¥è®¿é—®é™æ€æˆå‘˜å˜é‡ï¼ˆsharedï¼‰

é™æ€æˆå‘˜å‡½æ•°å¯ä»¥é€šè¿‡å¯¹è±¡è®¿é—®ï¼ˆ`a.f()`ï¼‰ï¼Œä¹Ÿå¯ä»¥é€šè¿‡ç±»è®¿é—®ï¼ˆ`A::f()`ï¼‰

å…¸å‹åº”ç”¨â€”â€”å•ä¾‹æ¨¡å¼ï¼š

```cpp
class singleton {
protected:
    singleton() {}
    singleton(const singleton &);

public:
    static singleton* instance() {
        return m_instance == NULL ?
            m_instance = new singleton :
            m_instance;
    }

    static void destroy() {
        delete m_instance;
        m_instance = NULL;
    }

private:
    static singleton* m_instance;
};

singleton* singleton::m_instance = NULL;
```

## 11. ç»§æ‰¿

```cpp
class Base {
public:
    void func();
};

class Derived : public Base {
    // Derived â€œç»§æ‰¿è‡ªâ€ Base
};
```

**æ„é€ é¡ºåº**ï¼š

1. **çˆ¶ç±»æ„é€ å‡½æ•°å…ˆæ‰§è¡Œ**
2. **å†æ‰§è¡Œå­ç±»æ„é€ å‡½æ•°**

```
Base() -> Derived()
```

**ææ„é¡ºåºï¼ˆç›¸åï¼‰**ï¼š

1. **å­ç±»ææ„å‡½æ•°å…ˆæ‰§è¡Œ**
2. **å†æ‰§è¡Œçˆ¶ç±»ææ„å‡½æ•°**

```
~Derived() -> ~Base()
```

**åŸºç±»æ„é€ å‡½æ•°çš„è°ƒç”¨**

- ç¼ºçœæ‰§è¡ŒåŸºç±»é»˜è®¤æ„é€ å‡½æ•°

- å¦‚æœè¦æ‰§è¡ŒåŸºç±»çš„**éé»˜è®¤æ„é€ å‡½æ•°**ï¼Œåˆ™å¿…é¡»åœ¨æ´¾ç”Ÿç±»æ„é€ å‡½æ•°çš„**æˆå‘˜åˆå§‹åŒ–è¡¨**ä¸­æŒ‡å‡º

```cpp
class A
{    int x;
  public:
     A() { x = 0; }
     A(int i) { x = i; }
};
class B: public A
{   int y;
public:
   B() { y = 0; }
   B(int i) { y = i; }
   B(int i, int j):A(i) 
   {   y = j;  }
};

B b1; 			//æ‰§è¡ŒA::A()å’ŒB::B()
B b2(1); 	   //æ‰§è¡ŒA::A()å’ŒB::B(int)
B b3(0,1); 		//æ‰§è¡ŒA::A(int)å’ŒB::B(int,int)
```

**è™šå‡½æ•°**

``` cpp
class Base {
public:
    virtual void show() { std::cout << "Base show\n"; }
};

class Derived : public Base {
public:
    void show() override { std::cout << "Derived show\n"; }
};

Base* p = new Derived();
p->show();   // è¾“å‡º Derived showï¼ˆåŠ¨æ€ç»‘å®šï¼‰

```

å…¸å‹ä½¿ç”¨åœºæ™¯ï¼š

1. å¤šæ€æ¥å£

```cpp
class Shape {
public:
    virtual void draw() = 0; // çº¯è™šå‡½æ•°
};
```

2. ç»Ÿä¸€å¤„ç†ä¸åŒå­ç±»å¯¹è±¡

```cpp
std::vector<Shape*> shapes;
shapes.push_back(new Circle());
shapes.push_back(new Square());

for (auto s : shapes)
    s->draw();   // è‡ªåŠ¨è°ƒç”¨æ­£ç¡®å¯¹è±¡çš„ draw
```

3. ç”¨äºææ„å‡½æ•°ï¼ˆå¿…é¡» virtualï¼‰

å¦‚æœçˆ¶ç±»ä½œä¸ºå¤šæ€åŸºç±»ï¼Œå…¶ææ„å‡½æ•°å¿…é¡»æ˜¯ virtualï¼š

```cpp
class Base {
public:
    virtual ~Base() {}
};
```

è¿™æ · delete Base* æŒ‡å‘ Derived æ—¶ï¼Œæ‰ä¼šè°ƒç”¨ Derived çš„ææ„ã€‚

![image-20251203185505065](C++/image-20251203185505065.png)

> ç±»çš„æˆå‘˜å‡½æ•°æ‰å¯ä»¥æ˜¯è™šå‡½æ•°
>
> é™æ€æˆå‘˜å‡½æ•°ä¸èƒ½æ˜¯è™šå‡½æ•°
>
> å†…è”æˆå‘˜å‡½æ•°ä¸èƒ½æ˜¯è™šå‡½æ•°
>
> æ„é€ å‡½æ•°ä¸èƒ½æ˜¯è™šå‡½æ•°
>
> ææ„å‡½æ•°å¯ä»¥ï¼ˆå¾€å¾€ï¼‰æ˜¯è™šå‡½æ•°

![image-20251203185819682](C++/image-20251203185819682.png)

**å‹å…ƒï¼ˆfriendï¼‰ä¸ protected çš„å…³ç³»**

- protected æˆå‘˜å¯¹å­ç±»å’Œå‹å…ƒå¼€æ”¾
- ä¸€ä¸ªç±»çš„ friend åªèƒ½è®¿é—®è¯¥ç±»çš„ private/protected
- æ— æ³•è®¿é—®åŸºç±»çš„ protectedï¼ˆé™¤éè¯¥åŸºç±»ä¹Ÿå£°æ˜å…¶ä¸º friendï¼‰

## 12. å¤šç»§æ‰¿

```cpp
class D : public B1, public B2 {
public:
    D() : B1(), B2() {}
};
```

æ„é€ é¡ºåºï¼šB1 â†’ B2 â†’ Dï¼Œææ„ç›¸å

å¦‚æœä¸¤ä¸ªåŸºç±»éƒ½æœ‰åŒåæˆå‘˜ï¼Œä¼šå†²çªï¼Œä¾‹å¦‚ï¼š

```cpp
class B1 { public: void f(); };
class B2 { public: void f(); };

class D : public B1, public B2 { };
```

è°ƒç”¨æ—¶å¿…é¡»æ˜¾å¼æŒ‡å®šï¼š

```cpp
D d;
d.B1::f();
d.B2::f();
```

**é‡å¤åŸºç±»é—®é¢˜**ï¼š

```
    A
   / \
  B   C
   \ /
    D
```

è™šç»§æ‰¿ï¼ˆvirtual inheritanceï¼‰ï¼Œè™šåŸºç±»**åªä¿ç•™ä¸€ä»½å‰¯æœ¬**ï¼Œä¸ä¼šé‡å¤

```cpp
class B : virtual public A { };
class C : virtual public A { };
class D : public B, public C { };
```

è™šåŸºç±»çš„æ„é€ å‡½æ•°ç”±**æœ€æ–°æ´¾ç”Ÿç±»**è°ƒç”¨
 è™šåŸºç±»æ„é€ å‡½æ•°æ€»æ˜¯ä¼˜å…ˆäºéè™šåŸºç±»æ„é€ å‡½æ•°æ‰§è¡Œ

```cpp
class A {};
class B : virtual public A {};
class C : virtual public A {};
class D : public B, public C { };
```

æ„é€  D æ—¶ï¼ŒA çš„æ„é€ ç”± D è´Ÿè´£ï¼šA â†’ B â†’ C â†’ Dï¼Œåªæ„é€ ä¸€æ¬¡ï¼Œç¡®ä¿å”¯ä¸€ A

## 13. è¿ç®—ç¬¦é‡è½½

### åŸºæœ¬è§„åˆ™

**å¯ä»¥è¢«é‡è½½çš„è¿ç®—ç¬¦**ï¼š

<img src="./C++/image-20251224174601042.png" alt="image-20251224174601042" style="zoom:50%;" />

**ä¸èƒ½è¢«é‡è½½çš„è¿ç®—ç¬¦**ï¼š

<img src="./C++/image-20251224174733479.png" alt="image-20251224174733479" style="zoom:50%;" />

é‡è½½è¿ç®—ç¬¦æ–¹æ³•å¯ä»¥è¯´æ˜¯æˆå‘˜å‡½æ•°ï¼Œæ­¤æ—¶æŒ‡çš„æ˜¯`this`å’Œä¼ å…¥çš„å‚æ•°åšè¿ç®—ï¼ˆ `const String String::operator+ (const string& that)`è¡¨ç¤ºthiså’ŒthatåšåŠ è¿ç®—ï¼‰

ä¹Ÿå¯ä»¥æ˜¯å…¨å±€æ–¹æ³•ï¼Œæ­¤æ—¶è¦å†™å®Œæ•´çš„ä¼ å…¥å‚æ•°

å¯¹äºä½œä¸º**æˆå‘˜å‡½æ•°**çš„é‡è½½è¿ç®—ç¬¦æ–¹æ³•æ¥è¯´ï¼Œå­˜åœ¨ä¸€ä¸ªéšå¼çš„ç¬¬ä¸€å‚æ•°ï¼ˆå³`this`ï¼‰ï¼Œæ¯”å¦‚è¯´ï¼š

```
Integer x(1),y(2),z;
x+y	====> x.operator+(y)
```

æ­¤æ—¶xä¸º**receiver**ï¼Œå¯¹receiveræ˜¯ä¸åštype conversionï¼ˆç±»å‹è½¬æ¢ï¼‰çš„ï¼Œå› æ­¤å½¢å¦‚`z=3+y`çš„æ–¹æ³•æ˜¯é”™è¯¯çš„ï¼Œå› ä¸º3ä¸ä¼šè¢«ç±»å‹è½¬æ¢æˆIntegerï¼›è€Œ`z=y+3`æ˜¯å¯è¡Œçš„ï¼Œå› ä¸º3å¯ä»¥è¢«åˆå§‹åŒ–æˆInteger

ä¸€å…ƒçš„è¿ç®—ç¬¦é‡è½½ç±»ä¼¼ï¼Œåªä¸è¿‡ä¸æ¥å—å‚æ•°ï¼Œåªæœ‰ä¸€ä¸ªéšå¼çš„thisä½œä¸ºå‚æ•°

```Cpp
const Integer operator-() const{
	return Integer(-i);
}

z = -x // z.operator=(x.operator-())
```

ä½œä¸º**å…¨å±€å‡½æ•°**æ—¶ï¼Œéœ€è¦æ˜¾å¼åœ°ä¿ç•™æ‰€æœ‰å‚æ•°ï¼ˆæ³¨æ„å¦‚æœè¦è®¿é—®ç±»çš„privateå˜é‡éœ€è¦å£°æ˜å‹å…ƒæˆ–è€…ç»™å‡ºgetterå’Œsetterï¼‰

```Cpp
const Integer operator+(const Integer& rhs, const Integer& lhs);

z = x + y // opperator+(x, y)
```

æ­¤æ—¶ï¼Œç±»å‹è½¬æ¢ä¼šå‘ç”Ÿåœ¨æ‰€æœ‰å‚æ•°ä¸Šï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œå½¢å¦‚`z=3+y`çš„å‡½æ•°åœ¨è¿™é‡Œæ˜¯å¯è¡Œçš„

ç‰¹æ®Šçš„ï¼Œå½¢å¦‚`z=3+7`ä¹Ÿæ˜¯å¯è¡Œçš„ï¼Œåªä¸è¿‡è¿™é‡Œçš„`+`æ˜¯é»˜è®¤çš„intçš„åŠ å·ï¼Œè€Œä¸æ˜¯è‡ªå®šä¹‰çš„é‡è½½çš„åŠ å·ã€‚ä½†æ˜¯`=`æ˜¯é‡è½½çš„ï¼Œå› æ­¤ç»“æœ10ä¼šè¢«ç±»å‹è½¬æ¢æˆIntegerï¼Œä¾ç„¶æ˜¯æˆç«‹çš„ã€‚

> Tips.
>
> å¯¹äºUnaryè¿ç®—ç¬¦ï¼ˆå¦‚ï¼ã€-ç­‰ï¼‰ï¼Œå»ºè®®ä½œä¸ºæˆå‘˜å‡½æ•°å®Œæˆï¼Œç›´æ¥å¯¹thisæ“ä½œ
>
> å¯¹äº`=ã€()ã€[]ã€->ã€->*`**å¿…é¡»**ä½œä¸ºæˆå‘˜å‡½æ•°å®Œæˆ
>
> å¯¹äºå…¶ä»–çš„ä¸€èˆ¬çš„äºŒå…ƒè¿ç®—ç¬¦ï¼Œæ¨èä½œä¸ºå…¨å±€å‡½æ•°å®Œæˆ

å¯¹äºä¸ä¿®æ”¹ç®—å­çš„æ“ä½œç¬¦ï¼Œä¸€å®šè¦åŠ constï¼›ä¿®æ”¹ç®—å­çš„æ“ä½œç¬¦ï¼ˆå¦‚`++,--,+=,-=`ç­‰ï¼‰ï¼Œä¸èƒ½åŠ const

### åŸå‹

è¿ç®—ç¬¦é‡è½½çš„è¿”å›ç±»å‹ï¼š

- `+ = * / % ^ & | ~`
  - `const T operatorX(const T& l, const T& r) const`

- `! && || < <= == > >=`
  - `bool operatorX(const T& l, const T& r) const`

- `[]`
  - `T& T::operator[](int index)`
  - `operator[]` çš„ç›®æ ‡æ˜¯**æ¨¡æ‹Ÿå†…ç½®æ•°ç»„çš„è¡Œä¸º**ï¼Œå¦‚æœæ˜¯`T operator[](int index)`ï¼Œé‚£ä¹ˆå¯¹äº`a[i] = value`ï¼Œè¯­ä¹‰ä¸Šç­‰ä»·äº`operator[](a, i) = value`ï¼Œç„¶è€Œ`operator[](a, i)`è¿”å›çš„æ˜¯ä¸€ä¸ª**ä¸´æ—¶å¯¹è±¡**è€Œä¸æ˜¯å·¦å€¼ï¼Œä¸´æ—¶å¯¹è±¡æ˜¯ä¸èƒ½èµ‹å€¼çš„ï¼Œå› æ­¤è¦åŠ ä¸Š`&`ï¼›è‡³äºåŠ ä¸åŠ `const`ï¼Œå–å†³äºä½ å¸Œä¸å¸Œæœ›æœ‰`a[0] = 3`è¿™æ ·çš„è¡Œä¸º

é‚£ä¹ˆå¯¹äº`++,--`ï¼Œè¿”å›å€¼å’ŒåŸå‹æ˜¯æ€æ ·çš„å‘¢ï¼Ÿ

æˆ‘ä»¬è§„å®šï¼š

1. **å‰ç½®**è‡ªå¢/è‡ªå‡ï¼ˆprefix:`++a`,`--a`ï¼‰

   ```
   T& operator++();   // ++x
   T& operator--();   // --x
   ```

2. **åç½®**è‡ªå¢/è‡ªå‡ï¼ˆpostfix:`a++`,`a--`ï¼‰

   ```
   T operator++(int); // x++
   T operator--(int); // x--
   ```

åç½®ä¸­çš„å¤šå‡ºæ¥çš„`int`å‚æ•°æ˜¯ç”¨äºåŒºåˆ†ä¸¤ç§é‡è½½çš„ï¼Œä¸ä¼šå®é™…ä½¿ç”¨

prefixè¿”å›`T&`ï¼Œæ˜¯å› ä¸ºprefixè¿”å›çš„æ˜¯**è¢«ä¿®æ”¹åçš„é‚£ä¸ªå¯¹è±¡æœ¬èº«**ï¼Œæ˜¯å…ˆä¿®æ”¹å†èµ‹å€¼ï¼›è€Œpostfixè¿”å›`T`ï¼Œæ˜¯å› ä¸ºpostfixè¿”å›çš„æ˜¯**è¢«ä¿®æ”¹å‰çš„æ—§å€¼**ï¼Œæ˜¯å…ˆèµ‹å€¼å†ä¿®æ”¹ï¼Œè‡ªç„¶ä¸å¯èƒ½è¿”å›å¼•ç”¨

å®é™…å®ç°å¦‚ä¸‹ï¼š

```cpp
class Counter {
    int value;
public:
    Counter(int v = 0) : value(v) {}

    // prefix ++
    Counter& operator++() {
        ++value;
        return *this;
    }

    // postfix ++
    Counter operator++(int) {
        Counter old(*this);	// æ‹·è´æ„é€ 
        ++(*this);	// ç”¨prefixæ¥æ„é€ postfix
        return old;
    }
};
```

### ç±»å‹è½¬æ¢

```cpp
class PathName {
public:
    PathName(const std::string&);
};

std::string abc("abc");
PathName xyz;

xyz = abc;
```

ä¸Šè¿°èµ‹å€¼æ˜¯å¯è¡Œçš„ï¼Œ`xyz=abc`ç­‰ä»·äº`xyz.operator=(abc)`ï¼Œäºæ˜¯ç¼–è¯‘å™¨ä¼šå¯»æ‰¾`PathName`ç±»çš„`operator=`ï¼Œæ²¡æœ‰å®šä¹‰ï¼Œä½†C++ä¼š**è‡ªåŠ¨ç”Ÿæˆä¸€ä¸ªæ‹·è´èµ‹å€¼è¿ç®—ç¬¦**

```cpp
PathName& operator=(const PathName&);
```

äºæ˜¯é—®é¢˜çš„æ ¸å¿ƒå°±åœ¨äº`string`èƒ½å¦ç±»å‹è½¬æ¢æˆ`PathName`ï¼Œè¿™ä¸€ç‚¹åœ¨æ„é€ å‡½æ•°é‡Œæ˜¯å®ç°äº†çš„ï¼Œå› æ­¤è¿™æ ·çš„èµ‹å€¼æˆç«‹

å› æ­¤ä¸‹è¿°ä»£ç æ˜¯å¯ä»¥å‘ç”Ÿçš„ï¼š

```cpp
class One{
public:
	One(){}
};

class Two{
public:
	Two(const One&){}
};

void f(Two){};

int main(){
	One one;
	f(one);	//å¯ä»¥æ­£å¸¸è¿è¡Œï¼Œå› ä¸ºOneå¯ä»¥ç±»å‹è½¬æ¢æˆTwo
}
```

**é‚£å¦‚æœæˆ‘ä¸å¸Œæœ›è¿™æ ·çš„è‡ªåŠ¨è½¬æ¢å‘¢ï¼Ÿ**

New keywordï¼š`explicit`

```cpp
class PathName {
public:
    explicit PathName(const std::string&);	// ç¦æ­¢ç±»å‹è½¬æ¢
};

std::string abc("abc");
PathName xyz;

xyz = abc;	// errorï¼ï¼
```

```cpp
class One{
public:
	One(){}
};

class Two{
public:
	explicit Two(const One&){}
};

void f(Two){};

int main(){
	One one;
	// f(one);	é”™è¯¯ï¼
	f(Two(one))	// æ­£ç¡®ï¼Œä½†æ˜¯è¿™å°±ä¸æ˜¯ç±»å‹è½¬æ¢äº†ï¼Œè€Œæ˜¯é‡æ–°æ„é€ äº†ä¸€ä¸ªTwoçš„ä¸´æ—¶å˜é‡
}
```

æ­¤å¤–è¿˜æœ‰ä¸€ç§æ–¹æ³•ï¼Œå°±æ˜¯ç›´æ¥å®šä¹‰**ç±»å‹è½¬æ¢æˆå‘˜å‡½æ•°**

```cpp
operator T() const;	// å°† this è½¬æ¢æˆ T çš„æ–¹æ³•
```

æ²¡æœ‰å‚æ•°ã€explicitå’Œè¿”å›ç±»å‹

**æ€»ç»“ï¼šC++é‡Œçš„ç±»å‹è½¬æ¢ï¼š**

<img src="./C++/image-20251224212244528.png" alt="image-20251224212244528" style="zoom:50%;" />

```cpp
#include <iostream>
using namespace std;
class A
{
public:
    operator int() { return 1; }
    operator char*() { return NULL; }
};
int main()
{
    A a;
    int n;
    char* p = "New Dragon Inn";
    n = static_cast <int> (3.14);  // n çš„å€¼å˜ä¸º 3
    n = static_cast <int> (a);  //è°ƒç”¨ a.operator intï¼Œn çš„å€¼å˜ä¸º 1
    p = static_cast <char*> (a);  //è°ƒç”¨ a.operator char*ï¼Œp çš„å€¼å˜ä¸º NULL
    n = static_cast <int> (p);  //ç¼–è¯‘é”™è¯¯ï¼Œstatic_castä¸èƒ½å°†æŒ‡é’ˆè½¬æ¢æˆæ•´å‹
    p = static_cast <char*> (n);  //ç¼–è¯‘é”™è¯¯ï¼Œstatic_cast ä¸èƒ½å°†æ•´å‹è½¬æ¢æˆæŒ‡é’ˆ
    return 0;
}
```

### è‡ªæˆ‘èµ‹å€¼æ£€æŸ¥

```cpp
class String {
    char* data;
public:
    String(const char* s) {
        data = new char[strlen(s) + 1];
        strcpy(data, s);
    }

    ~String() {
        delete[] data;
    }

    String& operator=(const String& rhs) {
        delete[] data;
        data = new char[strlen(rhs.data) + 1];
        strcpy(data, rhs.data);
        return *this;
    }
};
```

æ­¤æ—¶å‡ºç°é—®é¢˜ï¼Œå¦‚æœæœ‰ï¼š

```cpp
String s("hello");
s = s;   // è‡ªæˆ‘èµ‹å€¼
```

`delete[] data`å¯¼è‡´äº§ç”Ÿæ‚¬ç©ºæŒ‡é’ˆï¼Œå› æ­¤ï¼Œèµ‹å€¼å·é‡è½½æ—¶ä¸€å®šè¦æ£€æŸ¥rhsæ˜¯ä¸æ˜¯è‡ªèº«ï¼ˆçœ‹åœ°å€æ˜¯å¦ç›¸åŒï¼‰

```cpp
String& operator=(const String& rhs) {
    if (this == &rhs)
        return *this;

    delete[] data;
    data = new char[strlen(rhs.data) + 1];
    strcpy(data, rhs.data);
    return *this;
}
```

### äºŒç»´æ•°ç»„

```cpp
Matrix m;
m[1][2] = 42;
```

è¯­ä¹‰ä¸Šç­‰ä»·äºï¼š

```cpp
(m.operator).operator
```

æ­¤æ—¶`int& operator[](int i, int j)`çš„å†™æ³•å°±æ˜¯é”™è¯¯çš„ï¼Œè¦ç”¨ä¸€ä¸ª**ä»£ç†**éš”å¼€

```cpp
#include <vector>
#include <cstddef>

class Matrix {
    std::vector<int> data;
    std::size_t rows, cols;

public:
    Matrix(std::size_t r, std::size_t c)
        : data(r * c), rows(r), cols(c) {}

    class RowProxy {
        int* row;
    public:
        RowProxy(int* r) : row(r) {}

        int& operator[](std::size_t j) {
            return row[j];
        }
    };	// åœ¨ç±»é‡Œåœ¨å®šä¹‰ä¸€ä¸ªä»£ç†ç±»

    RowProxy operator[](std::size_t i) {
        return RowProxy(&data[i * cols]);
    }
};
```



## 14. æ¨¡æ¿

ç¨‹åºè®¾è®¡ä¸­ç»å¸¸ä¼šç”¨åˆ°ä¸€äº›ç¨‹åºå®ä½“ï¼šå®ƒä»¬çš„å®ç°å’Œæ‰€å®Œæˆçš„åŠŸèƒ½åŸºæœ¬ç›¸åŒï¼Œä¸åŒçš„ä»…ä»…æ˜¯æ‰€æ¶‰åŠçš„æ•°æ®ç±»å‹ä¸åŒã€‚è€Œæ¨¡æ¿æ­£æ˜¯ä¸€ç§ä¸“é—¨å¤„ç†ä¸åŒæ•°æ®ç±»å‹çš„æœºåˆ¶ã€‚

æ¨¡æ¿æ˜¯æ³›å‹ç¨‹åºè®¾è®¡çš„åŸºç¡€ï¼ˆæ³›å‹generic typeâ€”â€”é€šç”¨ç±»å‹ä¹‹æ„ï¼‰ã€‚

```
template<typename T1, typename T2,......,typename Tn>
è¿”å›å€¼ç±»å‹ å‡½æ•°å(å‚æ•°åˆ—è¡¨)
{
    //â€¦â€¦
}
æ³¨æ„ï¼štypenameæ˜¯ç”¨æ¥å®šä¹‰æ¨¡æ¿å‚æ•°å…³é”®å­—ï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨class(åˆ‡è®°ï¼šä¸èƒ½ä½¿ç”¨structä»£æ›¿class)
```

å› æ­¤ï¼ŒSwapå¯ä»¥è¿™æ ·å†™ï¼š

```cpp
template<typename T>
void Swap(T& left, T& right)
{
	T temp = left;
	left = right;
 	right = temp;
} 
```

è¿™æ ·ï¼Œç¼–è¯‘å™¨å°±ä¼šæ£€æŸ¥ä½ çš„ä»£ç ï¼Œå¦‚æœä½ çš„ä»£ç ä¸­ç”¨åˆ°äº†è¯¥æ–¹æ³•ï¼Œç¼–è¯‘å™¨å°±ä¼šå®ä¾‹åŒ–ä¸€ä¸ªå½“å‰ç±»å‹çš„å‡½æ•°

æ¯”å¦‚ï¼Œä½ åœ¨åé¢çš„ä»£ç é‡Œå†™é“åˆ°äº†`Swap(a,b)`ï¼Œè¿™é‡Œçš„aå’Œbæ˜¯intç±»å‹ï¼Œé‚£ä¹ˆç¼–è¯‘å™¨å°±ä¼šå®ä¾‹åŒ–ä¸€ä¸ª`void Swap(int& left, int& right)`ï¼›å¦‚æœæ­¤æ—¶åˆæœ‰`Swap(c,d)`ï¼Œè€Œcå’Œdæ˜¯doubleç±»å‹çš„ï¼Œå°±ä¼šå†å®ä¾‹åŒ–ä¸€ä¸ª`void Swap(double& left, double& right)`ï¼Œåªæœ‰åœ¨â€œç”¨åˆ°â€æ—¶æ‰ä¼šç”Ÿæˆä»£ç 

å¹¶ä¸”ï¼Œå¯¹äºæ¨¡æ¿ç”Ÿæˆçš„å‡½æ•°ï¼Œæ‰€æœ‰çš„ç±»å‹æ£€æŸ¥éƒ½å‘ç”Ÿåœ¨ç¼–è¯‘å™¨è€Œä¸æ˜¯åŠ¨æ€æ£€æŸ¥ï¼Œå› æ­¤æ¨¡æ¿æ˜¯å¾ˆå®‰å…¨çš„

ä¸€èˆ¬æ¥è¯´ï¼Œä¸æŒ‡å®šç±»å‹çš„æƒ…å†µä¸‹ï¼Œæ¨¡æ¿å‡½æ•°æ˜¯**éšå¼å®ä¾‹åŒ–**çš„ï¼š

```cpp

template<class T>
T Add(const T& left, const T& right)
{
	return left + right;
}
int main()
{
	int a1 = 10, a2 = 20;
	double d1 = 10.0, d2 = 20.0;
	Add(a1, a2); //ç¼–è¯‘å™¨æ¨å‡ºTæ˜¯int
	Add(d1, d2); //ç¼–è¯‘å™¨æ¨å‡ºTæ˜¯double
    return 0;
}
```

ç„¶è€Œï¼Œè¿™æ ·è°ƒç”¨æ—¶å°±ä¼šå‡ºé”™ï¼š

```cpp
    int a1 = 10, a2 = 20;
	double d1 = 10.0, d2 = 20.0;
	Add(a1, d1); //err ç¼–è¯‘å™¨æ¨ä¸å‡ºæ¥
```

å¯¹æ­¤ï¼Œæˆ‘ä»¬å¯ä»¥é‡‡ç”¨**æ˜¾å¼å®ä¾‹åŒ–**çš„æ–¹å¼

```cpp

template<class T>
T Add(const T& left, const T& right)
{
	return left + right;
}
int main()
{
	int a1 = 10, a2 = 20;
	double d1 = 10.0, d2 = 20.0;
    //æ˜¾ç¤ºå®ä¾‹åŒ–
	Add<int>(a1, d1); //doubleéšå¼ç±»å‹è½¬æ¢æˆint 
	Add<double>(a1, d2); 
    return 0;
}
```

å½“ç„¶ï¼Œæ¨¡æ¿æ”¯æŒ**å¤šå‚æ•°**ï¼š

```cpp

template<class K, class V> //ä¸¤ä¸ªæ¨¡æ¿å‚æ•°
void Func(const K& key, const V& value)
{
	cout << key << ":" << value << endl;
}
int main()
{
	Func(1, 1); //Kå’ŒVå‡int
	Func(1, 1.1);//Kæ˜¯intï¼ŒVæ˜¯double
	Func<int, char>(1, 'A'); //å¤šä¸ªæ¨¡æ¿å‚æ•°ä¹Ÿå¯æŒ‡å®šæ˜¾ç¤ºå®ä¾‹åŒ–ä¸åŒç±»å‹
}
```

ç±»æ¨¡æ¿é‡Œçš„æ¯ä¸€ä¸ªå‡½æ•°éƒ½æ˜¯å‡½æ•°æ¨¡æ¿ï¼š

<img src="./C++/image-20251225002442229.png" alt="image-20251225002442229" style="zoom:50%;" />

<img src="./C++/image-20251225003228048.png" alt="image-20251225003228048" style="zoom:50%;" />

```cpp
template <class A> 
class Derived: public List<A>{}
```

â€œå®šä¹‰ä¸€ä¸ªç±»æ¨¡æ¿ `Derived`ï¼Œå®ƒä»¥ç±»å‹ `A` ä½œä¸ºæ¨¡æ¿å‚æ•°ï¼›å¯¹äºä»»æ„ç»™å®šçš„ `A`ï¼Œ`Derived<A>` éƒ½æ˜¯ä¸€ä¸ª**å…¬æœ‰ç»§æ‰¿è‡ª `List<A>` çš„ç±»**ã€‚â€

### ä¾‹

```cpp
#include <vector>
#include <cstddef>

template <class T>
class Box {
    T value;

public:
    /* ---------- æ„é€  ---------- */

    Box() : value{} {}

    explicit Box(const T& v) : value(v) {}

    /* ---------- æ˜¾å¼ç±»å‹è½¬æ¢ ---------- */

    explicit operator T() const {
        return value;
    }

    /* ---------- å¤åˆèµ‹å€¼ ---------- */

    Box& operator+=(const Box& rhs) {
        value += rhs.value;
        return *this;
    }

    Box& operator+=(const T& rhs) {
        value += rhs;
        return *this;
    }

    /* ---------- å‰ç½® ++ ---------- */

    Box& operator++() {
        ++value;
        return *this;
    }

    /* ---------- åç½® ++ ---------- */

    Box operator++(int) {
        Box old(*this);
        ++value;
        return old;
    }

    /* ---------- ä¸‹æ ‡è¿ç®—ç¬¦ ---------- */

    auto operator[](std::size_t i)
        -> decltype(value[i]) {
        return value[i];
    }

    auto operator[](std::size_t i) const
        -> decltype(value[i]) {
        return value[i];
    }

    /* ---------- éæˆå‘˜è¿ç®—ç¬¦éœ€è¦è®¿é—® value ---------- */

    template<class U>
    friend Box<U> operator+(const Box<U>&, const Box<U>&);

    template<class U>
    friend Box<U> operator+(const Box<U>&, const U&);

    template<class U>
    friend Box<U> operator+(const U&, const Box<U>&);

    template<class U>
    friend bool operator==(const Box<U>&, const Box<U>&);

    template<class U>
    friend bool operator==(const Box<U>&, const U&);

    template<class U>
    friend bool operator==(const U&, const Box<U>&);
};

/* ---------- éæˆå‘˜ + ---------- */

template<class T>
Box<T> operator+(const Box<T>& lhs, const Box<T>& rhs) {
    return Box<T>(lhs.value + rhs.value);
}

template<class T>
Box<T> operator+(const Box<T>& lhs, const T& rhs) {
    return Box<T>(lhs.value + rhs);
}

template<class T>
Box<T> operator+(const T& lhs, const Box<T>& rhs) {
    return Box<T>(lhs + rhs.value);
}

/* ---------- éæˆå‘˜ == ---------- */

template<class T>
bool operator==(const Box<T>& lhs, const Box<T>& rhs) {
    return lhs.value == rhs.value;
}

template<class T>
bool operator==(const Box<T>& lhs, const T& rhs) {
    return lhs.value == rhs;
}

template<class T>
bool operator==(const T& lhs, const Box<T>& rhs) {
    return lhs == rhs.value;
}

```





















